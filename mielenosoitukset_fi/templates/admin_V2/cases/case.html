{% extends "admin_base.html" %}
{% block main_content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Header */
    .page-header {
        margin-bottom: 40px;
        animation: fadeInDown 0.6s ease-out;
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 12px;
        background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .case-number {
        opacity: 0.6;
        font-weight: 400;
    }

    .page-subtitle {
        color: #a0a0a0;
        font-size: 0.95rem;
        line-height: 1.6;
        max-width: 700px;
    }

    /* Tags */
    .case-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 35px;
        animation: fadeIn 0.8s ease-out;
    }

    .tag {
        padding: 8px 18px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 500;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        background: rgba(233, 30, 99, 0.15);
        color: #f48fb1;
        border: 1px solid rgba(233, 30, 99, 0.3);
    }

    .tag:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(233, 30, 99, 0.4);
        background: rgba(233, 30, 99, 0.25);
    }

    /* Grid Layout */
    .case-content {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 30px;
        animation: fadeIn 1s ease-out;

    }

    @media (max-width: 1200px) {
        .case-content {
            grid-template-columns: 1fr;
        }
    }

    /* Cards */
    .card {
        background: rgba(30, 30, 46, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
        margin-bottom: 25px;
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(233, 30, 99, 0.2);
        border-color: rgba(233, 30, 99, 0.2);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 24px;
        padding-bottom: 18px;
        border-bottom: 2px solid rgba(233, 30, 99, 0.2);
    }

    .card-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .icon {
        width: 24px;
        height: 24px;
        stroke-width: 2;
    }

    /* Case Type Badge */
    .case-type-badge {
        display: inline-block;
        padding: 8px 18px;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 600;
        background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
        color: white;
        text-transform: capitalize;
        box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
    }

    /* Info Sections */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .info-box {
        background: rgba(20, 20, 30, 0.6);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }

    .info-box:hover {
        background: rgba(20, 20, 30, 0.8);
        border-color: rgba(233, 30, 99, 0.3);
    }

    .info-box h3 {
        font-size: 1.1rem;
        margin-bottom: 15px;
        color: #f48fb1;
        display: flex;
        align-items: center;
        gap: 8px;
    }


    /* Element | http://127.0.0.1:5002/admin/case/12/ */

    .w-full {
        border: 2px hotpink solid !important;
        border-radius: 10px;
        max-width: 300px;
    }

    .whitespace-pre-line {
        color: white;
    }


    .info-item {
        margin-bottom: 12px;
        font-size: 0.9rem;
        line-height: 1.6;
        color: white;
    }

    .info-item strong {
        color: #e91e63;
        display: inline-block;
        min-width: 120px;
    }

    /* Forms */
    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #a0a0a0;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .form-input,
    .form-textarea,
    .form-select {
        width: 100%;
        padding: 12px 16px;
        background: rgba(20, 20, 30, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: #e8e8e8;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
        outline: none;
        border-color: #e91e63;
        box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        background: rgba(20, 20, 30, 1);
    }

    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }

    /* Buttons */
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(233, 30, 99, 0.5);
    }

    .btn-success {
        background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(76, 175, 80, 0.5);
    }

    .btn-danger {
        background: linear-gradient(135deg, #f44336 0%, #e57373 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(244, 67, 54, 0.5);
    }

    .btn-warning {
        background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
    }

    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(255, 152, 0, 0.5);
    }

    .btn-block {
        width: 100%;
        justify-content: center;
        margin-bottom: 12px;
    }

    /* Action Log */
    .action-log {
        background: rgba(20, 20, 30, 0.6);
        border-radius: 16px;
        padding: 20px;
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .log-entry {
        padding: 12px;
        margin-bottom: 10px;
        background: rgba(30, 30, 46, 0.5);
        border-radius: 10px;
        border-left: 3px solid #e91e63;
        transition: all 0.3s ease;
    }

    .log-entry:hover {
        background: rgba(30, 30, 46, 0.8);
        transform: translateX(5px);
    }

    .log-entry strong {
        color: #f48fb1;
    }

    .log-timestamp {
        color: #666;
        font-size: 0.8rem;
        margin-left: 10px;
    }

    /* Sidebar */
    .sidebar {
        position: sticky;
        top: 20px;
    }

    .sidebar .card {
        margin-bottom: 20px;
    }

    /* Timeline */
    .timeline {
        position: relative;
        padding-left: 30px;
    }

    .timeline::before {
        content: '';
        position: absolute;
        left: 10px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(180deg, #e91e63 0%, transparent 100%);
    }

    .timeline-item {
        position: relative;
        margin-bottom: 20px;
        padding-left: 15px;
    }

    .timeline-item::before {
        content: '';
        position: absolute;
        left: -24px;
        top: 5px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #e91e63;
        box-shadow: 0 0 10px rgba(233, 30, 99, 0.5);
    }

    .timeline-item:hover::before {
        transform: scale(1.3);
        box-shadow: 0 0 20px rgba(233, 30, 99, 0.8);
    }

    .timeline-time {
        color: #666;
        font-size: 0.85rem;
    }

    .timeline-action {
        color: #e8e8e8;
        font-size: 0.9rem;
    }

    /* Modal */
    .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease-out;
    }

    .modal:not(.show) {
        display: none;
    }

    .modal.hidden {
        display: none;
    }

    .modal-content {
        background: linear-gradient(135deg, rgba(30, 30, 46, 0.98) 0%, rgba(20, 20, 35, 0.98) 100%);
        border-radius: 24px;
        padding: 40px;
        width: 90%;
        max-width: 550px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(233, 30, 99, 0.3);
        animation: slideUp 0.4s ease-out;
    }

    .modal-header {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 25px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .modal-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-top: 30px;
    }

    .btn-secondary {
        background: rgba(100, 100, 100, 0.3);
        color: #e8e8e8;
    }

    .btn-secondary:hover {
        background: rgba(100, 100, 100, 0.5);
    }

    /* Changes List */
    .changes-list {
        list-style: none;
        padding: 0;
    }

    .changes-list li {
        padding: 10px 15px;
        margin-bottom: 8px;
        background: rgba(20, 20, 30, 0.6);
        border-radius: 10px;
        border-left: 3px solid #e91e63;
    }

    .changes-list strong {
        color: #f48fb1;
    }

    .change-arrow {
        color: #666;
        margin: 0 8px;
    }

    /* Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Scrollbar */
    .action-log::-webkit-scrollbar {
        width: 8px;
    }

    .action-log::-webkit-scrollbar-track {
        background: rgba(20, 20, 30, 0.5);
        border-radius: 10px;
    }

    .action-log::-webkit-scrollbar-thumb {
        background: #e91e63;
        border-radius: 10px;
    }

    .action-log::-webkit-scrollbar-thumb:hover {
        background: #f06292;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .empty-state svg {
        width: 48px;
        height: 48px;
        margin-bottom: 15px;
        opacity: 0.3;
    }

    /* Success/Error Messages */
    .message {
        padding: 15px 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideUp 0.4s ease-out;
    }

    .message-success {
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid rgba(76, 175, 80, 0.3);
        color: #81c784;
    }

    .message-error {
        background: rgba(244, 67, 54, 0.2);
        border: 1px solid rgba(244, 67, 54, 0.3);
        color: #e57373;
    }
</style>

<div class="dashboard-container">
    <!-- Page Header -->
    <section class="page-header">
        <h1>
            Tapaus <span class="case-number">#{{ case_id }}</span>
        </h1>
        <p class="page-subtitle">
            {{ _('T√§m√§ n√§kym√§ n√§ytt√§√§ asiakaspalvelun pyynn√∂n tiedot ja mahdollistaa k√§sittelyn.') }}<br>
            {{ _('Muistathan tallentaa tekem√§si muutokset tai lis√§t√§ sis√§iset muistiinpanot ennen poistumista.') }}
        </p>
    </section>

    <!-- Tags -->
    <section class="case-tags">
        {% for tag in case_tags %}
        <span class="tag">{{ tag }}</span>
        {% endfor %}
        {% if not case_tags %}
        <span class="tag" style="opacity: 0.5;">{{ _('Ei tunnisteita lis√§tty.') }}</span>
        {% endif %}
    </section>

    <!-- Main Content Grid -->
    <section class="case-content">
        <!-- Main Column -->
        <div class="main-column">

            <!-- Case Type Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        {{ _('Pyynt√∂tyyppi') }}
                    </h2>
                </div>

                <span class="case-type-badge">{{ case_type|capitalize|replace('_', ' ') }}</span>

                {% if case_type == "demo_error_report" %}
                <div class="info-grid">
                    <div class="info-box">
                        <h3>
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            {{ _('Virheraportti') }}
                        </h3>
                        <div class="info-item">
                            <strong>{{ _('Ongelma:') }}</strong><br>
                            {{ case_data.error_description }}
                        </div>
                        <div class="info-item">
                            <strong>{{ _('Raportoija:') }}</strong> {{ case_data.reported_by }}
                        </div>
                        <div class="info-item">
                            <strong>{{ _('Aikaleima:') }}</strong> {{ case_data.timestamp }}
                        </div>
                    </div>

                    <div class="info-box">
                        <h3>
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            {{ _('Demon tiedot') }}
                        </h3>
                        <div class="info-item">
                            <strong>{{ _('Nimi:') }}</strong> {{ case_data.demo.name }}
                        </div>
                        <div class="info-item">
                            <strong>{{ _('P√§iv√§m√§√§r√§:') }}</strong> {{ case_data.demo.date }}
                        </div>
                        <div class="info-item">
                            <strong>{{ _('Kuvaus:') }}</strong> {{ case_data.demo.description }}
                        </div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <h3>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        {{ _('Muokkaa tietoja') }}
                    </h3>
                    <form id="demo-edit-form">
                        <div class="form-group">
                            <label class="form-label">{{ _('Nimi') }}</label>
                            <input type="text" name="name" value="{{ case_data.demo.name }}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">{{ _('P√§iv√§m√§√§r√§') }}</label>
                            <input type="text" name="date" value="{{ case_data.demo.date }}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">{{ _('Kuvaus') }}</label>
                            <textarea name="description"
                                class="form-textarea">{{ case_data.demo.description }}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                            </svg>
                            {{ _('Tallenna muutokset') }}
                        </button>
                    </form>
                </div>

                {% elif case_type == "organization_edit_suggestion" %}
                <div class="info-box" style="margin-top: 20px;">
                    <h3>
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                        {{ _('Organisaation tiedot') }}
                    </h3>
                    <div class="info-item">
                        <strong>{{ _('Organisaatio:') }}</strong> {{ case_data.organization_name }}
                    </div>
                    <div class="info-item">
                        <strong>{{ _('Ehdotetut muutokset:') }}</strong>
                    </div>
                    <ul class="changes-list">
                        {% for change in case_data.changes %}
                        <li>
                            <strong>{{ change.field }}</strong>
                            <span class="change-arrow">‚Üí</span>
                            <span style="text-decoration: line-through; opacity: 0.6;">{{ change.old }}</span>
                            <span class="change-arrow">‚Üí</span>
                            <span style="color: #81c784;">{{ change.new }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                {% elif case_type == "new_demo" %}
                <div class="info-box mt-6">

                    <h3 class="flex items-center gap-2 text-xl font-semibold mb-3">
                        <svg class="icon w-6 h-6 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z" />
                        </svg>
                        {{ _('Uusi mielenosoitus') }}
                    </h3>

                    <div class="grid md:grid-cols-2 gap-4">

                        <!-- Left: main info -->
                        <div class="space-y-2">
                            <div class="info-item">
                                <strong>{{ _('Otsikko:') }}</strong> {{ case_data.demo.title }}
                            </div>
                            <div class="info-item">
                                <strong>{{ _('P√§iv√§m√§√§r√§:') }}</strong> {{ case_data.demo.date }}
                            </div>
                            <div class="info-item">
                                <strong>{{ _('Alkamisaika:') }}</strong> {{ case_data.demo.start_time }}
                            </div>
                            {% if case_data.demo.end_time %}
                            <div class="info-item">
                                <strong>{{ _('P√§√§ttymisaika:') }}</strong> {{ case_data.demo.end_time }}
                            </div>
                            {% endif %}
                            <div class="info-item">
                                <strong>{{ _('Kaupunki:') }}</strong> {{ case_data.demo.city }}
                            </div>
                            <div class="info-item">
                                <strong>{{ _('Osoite:') }}</strong> {{ case_data.demo.address }}
                            </div>
                            {% if case_data.demo.route %}
                            <div class="info-item">
                                <strong>{{ _('Reitti:') }}</strong> {{ case_data.demo.route }}
                            </div>
                            {% endif %}
                            <div class="info-item">
                                <strong>{{ _('Tapahtumatyyppi:') }}</strong> {{ case_data.demo.event_type }}
                            </div>
                            {% if case_data.demo.facebook %}
                            <div class="info-item">
                                <strong>Facebook:</strong> <a href="{{ case_data.demo.facebook }}" target="_blank"
                                    class="text-pink-400 underline">Linkki</a>
                            </div>
                            {% endif %}
                            {% if case_data.demo.tags %}
                            <div class="info-item">
                                <strong>{{ _('Tunnisteet:') }}</strong>
                                {% for tag in case_data.demo.tags %}
                                <span class="bg-pink-100 text-pink-700 px-2 py-0.5 rounded-lg text-sm">{{ tag }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Right: description + photo -->
                        <div>
                            {% if case_data.demo.img %}
                            <img src="{{ case_data.demo.img }}" alt="Demo image"
                                class="w-full rounded-xl border border-neutral-700 mb-3 shadow-md">
                            {% endif %}
                            <p class="whitespace-pre-line">{{ case_data.demo.description }}</p>
                        </div>
                    </div>

                    <hr class="my-6 border-neutral-700">

                    <!-- Organizers -->
                    {% if case_data.demo.organizers %}
                    <div class="info-item">
                        <strong>{{ _('J√§rjest√§j√§t:') }}</strong>
                        <ul class="list-disc ml-6">
                            {% for org in case_data.demo.organizers %}
                            <li>
                                {{ org.name }}
                                {% if org.email %}<span class="text-sm text-neutral-400">({{ org.email }})</span>{%
                                endif %}
                                {% if org.website %}<a href="{{ org.website }}" target="_blank"
                                    class="text-pink-400 text-sm ml-1 underline">{{ _('Sivusto') }}</a>{% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <hr class="my-6 border-neutral-700">

                    <!-- Submitter info -->
                    <div class="info-item">
                        <h4 class="font-semibold mb-2">{{ _('Ilmoittaja') }}</h4>
                        <p><strong>{{ _('Nimi:') }}</strong> {{ case_data.submitter.submitter_name }}</p>
                        <p><strong>{{ _('S√§hk√∂posti:') }}</strong> {{ case_data.submitter.submitter_email }}</p>
                        <p><strong>{{ _('Rooli:') }}</strong> {{ case_data.submitter.submitter_role }}</p>
                        <p><strong>{{ _('Hyv√§ksynyt ehdot:') }}</strong>
                            {% if case_data.submitter.accept_terms %}
                            ‚úÖ
                            {% else %}
                            ‚ùå
                            {% endif %}
                        </p>
                        <p><small class="text-neutral-500">{{ _('L√§hetetty:') }} {{ case_data.submitter.submitted_at
                                }}</small></p>
                    </div>

                    <div class="actions mt-8 flex gap-4">
                        <button class="btn-accept">{{ _('Hyv√§ksy mielenosoitus') }}</button>
                        <button class="btn-reject">{{ _('Hylk√§√§') }}</button>
                        <button class="btn-escalate">{{ _('Eskaloi hallitukselle') }}</button>
                    </div>

                </div>
                {% endif %}

            </div>

            <!-- Action Log Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        {{ _('Sis√§iset toimet ja muistiinpanot') }}
                    </h2>
                </div>

                <form id="action-log-form">
                    <div class="form-group">
                        <label class="form-label">{{ _('Toimenpide') }}</label>
                        <select name="action_type" class="form-select">
                            <option value="accept">‚úì {{ _('Hyv√§ksytty') }}</option>
                            <option value="reject">‚úó {{ _('Hyl√§tty') }}</option>
                            <option value="note">üìù {{ _('Muistiinpano') }}</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">{{ _('Syy tai kuvaus') }}</label>
                        <textarea name="reason" placeholder="Kirjoita syy tai perustelu..."
                            class="form-textarea"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        {{ _('Lis√§√§ merkint√§') }}
                    </button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: #f48fb1;">
                        {{ _('Aiemmat merkinn√§t') }}
                    </h3>
                    <div id="action-log" class="action-log">
                        {% for log in action_logs %}
                        <div class="log-entry">
                            <strong>{{ log.user }}</strong>: {{ log.reason }}
                            <span class="log-timestamp">{{ log.timestamp }}</span>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <p>{{ _('Ei viel√§ merkint√∂j√§.') }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Actions Card -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        {{ _('Toiminnot') }}
                    </h3>
                </div>

                <button class="btn btn-success btn-block">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ _('Hyv√§ksy pyynt√∂') }}
                </button>

                <button class="btn btn-danger btn-block">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ _('Hylk√§√§ pyynt√∂') }}
                </button>

                <button class="btn btn-warning btn-block" onclick="openEscalationModal()">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    {{ _('Eskaloi hallitukselle') }}
                </button>
            </div>

            <!-- History Card -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        {{ _('Tapahtumahistoria') }}
                    </h3>
                </div>

                <div class="timeline">
                    {% for event in case_history %}
                    <div class="timeline-item">
                        <div class="timeline-time">{{ event.timestamp }}</div>
                        <div class="timeline-action">{{ event.action }}</div>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p>{{ _('Ei tapahtumia.') }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </aside>
    </section>
</div>

<!-- Escalation Modal -->
<div id="escalation-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="modal-header">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
            {{ _('Eskaloi hallituksen k√§sittelyyn') }}
        </h3>

        <form id="escalate-form">
            <div class="form-group">
                <label class="form-label">{{ _('Syy eskalointiin') }}</label>
                <textarea name="reason" class="form-textarea"
                    placeholder="Kerro miksi t√§m√§ tapaus vaatii hallituksen huomiota..."></textarea>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEscalationModal()">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    {{ _('Peruuta') }}
                </button>
                <button type="submit" class="btn btn-primary">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                    {{ _('L√§het√§ eskalointi') }}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Modal functions
    function openEscalationModal() {
        document.getElementById('escalation-modal').classList.remove('hidden');
        document.getElementById('escalation-modal').classList.add('show');


    }

    function closeEscalationModal() {
        document.getElementById('escalation-modal').classList.add('hidden');
        document.getElementById('escalation-modal').classList.remove('show');

    }


    document.addEventListener("DOMContentLoaded", () => {
        let tcm = document.getElementById("taskConfirmModal");
        tcm.remove();
    })
    // Close modal on background click
    document.getElementById('escalation-modal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeEscalationModal();
        }
    });

    // Demo edit form handler
    document.getElementById('demo-edit-form')?.addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);

        // Show success message
        showMessage('success', 'Muutokset tallennettu onnistuneesti!');

        // Here you would typically send the data to the server
        console.log('Demo edit data:', Object.fromEntries(formData));
    });

    // Action log form handler
    document.getElementById('action-log-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const actionType = formData.get('action_type');
        const reason = formData.get('reason');

        if (!reason.trim()) {
            showMessage('error', 'Sy√∂t√§ kuvaus tai syy toimenpiteelle.');
            return;
        }

        // Add to action log
        const logContainer = document.getElementById('action-log');
        const emptyState = logContainer.querySelector('.empty-state');
        if (emptyState) {
            emptyState.remove();
        }

        const now = new Date();
        const timestamp = now.toLocaleString('fi-FI');

        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.innerHTML = `<strong>Sin√§</strong>: ${reason} <span class="log-timestamp">${timestamp}</span>`;
        logEntry.style.animation = 'slideUp 0.4s ease-out';

        logContainer.insertBefore(logEntry, logContainer.firstChild);

        // Clear form
        this.reset();

        showMessage('success', 'Merkint√§ lis√§tty onnistuneesti!');
    });

    // Escalation form handler
    document.getElementById('escalate-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const reason = formData.get('reason');

        if (!reason.trim()) {
            showMessage('error', 'Sy√∂t√§ syy eskalointiin.');
            return;
        }

        // Here you would typically send the escalation to the server
        console.log('Escalation reason:', reason);

        closeEscalationModal();
        showMessage('success', 'Tapaus eskaloitu hallitukselle!');

        this.reset();
    });

    // Message display function
    function showMessage(type, text) {
        const existingMessage = document.querySelector('.message');
        if (existingMessage) {
            existingMessage.remove();
        }

        const message = document.createElement('div');
        message.className = `message message-${type}`;

        const icon = type === 'success'
            ? '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'
            : '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';

        message.innerHTML = icon + '<span>' + text + '</span>';

        const container = document.querySelector('.dashboard-container');
        container.insertBefore(message, container.firstChild);

        // Auto-remove after 5 seconds
        setTimeout(() => {
            message.style.animation = 'fadeIn 0.3s ease-out reverse';
            setTimeout(() => message.remove(), 300);
        }, 5000);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function (e) {
        // ESC to close modal
        if (e.key === 'Escape') {
            closeEscalationModal();
        }
    });
</script>

{% endblock %}