{% extends 'base.html' %}
{% block title %} {{ demo['title'] }} {% endblock %}
{% block meta %}
<!-- General Meta Tags -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}" />
<meta name="keywords" content="{{ demo['keywords'] if demo['keywords'] else 'mielenosoitus, tapahtuma, Helsinki' }}" />
<meta name="author" content="Mielenosoitukset.fi" />
<meta name="robots" content="index, follow" />

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="{{ demo['title'] if demo['title'] else 'Mielenosoitus' }}" />
<meta property="og:description"
  content="{{ demo['title'] }} -mielenosoitus kaupungissa {{ demo['city'] }}. {{ demo['date'] }}" />
<meta property="og:image"
  content="{{ demo['preview_image'] if demo['preview_image'] else url_for('static', filename='demo_preview/' + demo['_id'] + '.png', _external=True) }}" />
<meta property="og:url" content="{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}" />
<meta property="og:type" content="event" />
<meta property="og:site_name" content="Mielenosoitukset.fi" />
<meta property="og:locale" content="fi_FI" />
<meta property="og:updated_time"
  content="{{ demo['updated_time'] if demo['updated_time'] else '2025-01-01T00:00:00' }}" />
<meta property="og:see_also" content="{{ demo['related_links'] if demo['related_links'] else '' }}" />
<meta property="og:event:start_time" content="{{ demo['start_time'] }}" />
<meta property="og:event:end_time" content="{{ demo['end_time'] }}" />
<meta property="og:event:location" content="{{ demo['address'] }}, {{ demo['city'] }}" />

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ demo['title'] if demo['title'] else 'Mielenosoitus' }}" />
<meta name="twitter:description"
  content="{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}" />
<meta name="twitter:image"
  content="{{ demo['preview_image'] if demo['preview_image'] else url_for('static', filename='demo_preview/' + demo['_id'] + '.png', _external=True) }}" />
<meta name="twitter:url" content="{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}" />
<meta name="twitter:site" content="@Mielenosoitukset" />
<meta name="twitter:creator" content="@Mielenosoitukset" />
<meta name="twitter:image:alt"
  content="{{ demo['description'] if demo['description'] else 'Mielenosoituksen kuva' }}" />
<meta name="twitter:label1" content="Päivämäärä" />
<meta name="twitter:data1" content="{{ demo['date'] }}" />
<meta name="twitter:label2" content="Paikka" />
<meta name="twitter:data2" content="{{ demo['city'] }}" />

<!-- Facebook Open Graph App ID -->
<meta property="fb:app_id" content="{{ demo['fb_app_id'] if demo['fb_app_id'] else '' }}" />
<meta property="fb:pages" content="{{ demo['fb_page_id'] if demo['fb_page_id'] else '' }}" />

<!-- Additional Social Media Meta Tags -->
<meta property="article:author"
  content="{{ demo['organizers'][0]['name'] if demo['organizers'] else 'Tuntematon kirjoittaja' }}" />
<meta property="article:section" content="{{ demo['section'] if demo['section'] else 'Tapahtumat' }}" />
<meta property="article:tag" content="{{ demo['tags'] if demo['tags'] else 'mielenosoitus, tapahtuma' }}" />
<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "{{ demo['title'] if demo['title'] else 'Tuntematon tapahtuma' }}",
  "startDate": "{{ demo['date'] }}T{{ demo['start_time'] if demo['start_time'] else '00:00:00' }}",
  "endDate": "{{ demo['date'] }}T{{ demo['end_time'] if demo['end_time'] else '00:00:00' }}",
  "location": {
    "@type": "Place",
    "name": "{{ demo['topic'] if demo['topic'] else 'Tuntematon paikka' }}",
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "{{ demo['latitude'] if demo['latitude'] else '' }}",
      "longitude": "{{ demo['longitude'] if demo['longitude'] else '' }}"
    }
  },
  "description": "{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}",
  "image": "{{ demo['preview_image'] if demo['preview_image'] else url_for('screenshot', demo_id=demo['_id'], _external=True) }}",
  "url": "{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}",
  "organizer": {
    "@type": "Organization",
    "name": "{{ demo['organizers'][0]['name'] if demo['organizers'] and demo['organizers'][0]['name'] else 'Tuntematon' }}",
    "url": "{{ url_for('org', org_id=demo['organizers'][0]['organization_id']) if demo['organizers'] and demo['organizers'][0]['organization_id'] else '#' }}"
  }
}
</script>

{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='/css/toolbox.css' )}}" />
<link rel="stylesheet" href="{{ url_for('static', filename='/css/details.css' )}}" />
<link rel="stylesheet" href="{{ url_for('static', filename='leaflet/leaflet.css') }}" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
<style>
:root {
  --color-bg: light-dark(#f9f9f9, #181a1b);
  --color-bg-hero: light-dark(#e3f0ff, #23272a);
  --color-card-bg: light-dark(#fff, #23272a);
  --color-text: light-dark(#222, #f3f3f3);
  --color-text-secondary: light-dark(#444, #c7c7c7);
  --color-primary: light-dark(#0056b3, #4ea1ff);
  --color-shadow: light-dark(0 2px 12px rgba(0,0,0,0.06), 0 2px 12px rgba(0,0,0,0.3));
  --color-shadow-hover: light-dark(0 4px 16px rgba(0,86,179,0.08), 0 4px 16px rgba(78,161,255,0.12));
  --color-title-accent: light-dark(#e3f0ff, #2a3a4a);
  --primary_color: var(--color-primary);
  --primary_dark_color: light-dark(#003d80, #0056b3);
  --background: var(--color-card-bg);
  --primary_text_color: var(--color-text);
  --primary_strong_text_color: var(--color-primary);
  --box_shadow: var(--color-shadow);
  --yellow: #ffe066;
  --black: light-dark(#222, #f3f3f3);
}

.button, .btn, .btn-primary, .btn-warning, .btn-secondary {
  background: var(--primary_color) !important;
  color: #fff !important;
  border: 2px solid var(--primary_dark_color) !important;
  border-radius: 2em !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  font-weight: 600;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
}
.button:hover, .btn:hover, .btn-primary:hover, .btn-warning:hover, .btn-secondary:hover {
  background: var(--primary_dark_color) !important;
  color: #fff !important;
  border-color: var(--primary_color) !important;
}

/* Modal z-index fix */
.modal-backdrop { z-index: 1000001 !important; }
.modal { z-index: 1000002 !important; }

main body {
  background: var(--color-bg);
  color: var(--color-text);
}
main .container-main-content {
  background: var(--color-card-bg);
  border-radius: 1.2em;
  box-shadow: var(--box_shadow);
  padding: 2em 1em 2em 1em;
  margin-bottom: 2em;
  margin-top: 1.5em;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  border: none;
}
main h1, main .subtitle {
  color: var(--primary_color);
  font-weight: 800;
  letter-spacing: 0.01em;
  text-align: center;
}
main h1 {
  font-size: 2.1em;
  margin-bottom: 0.5em;
}
main .subtitle {
  font-size: 1.5em;
  margin-bottom: 0.7em;
}
main .button-container {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
}
main .button {
  background-color: var(--primary_color);
  color: #fff;
  padding: 0.7em 1.5em;
  border: 2px solid var(--primary_dark_color);
  border-radius: 2em;
  cursor: pointer;
  text-decoration: none;
  font-size: 1.05em;
  font-weight: 600;
  transition: background 0.2s, box-shadow 0.2s, color 0.2s;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
main .button:hover {
  background-color: var(--primary_dark_color);
  color: #fff;
  box-shadow: var(--color-shadow-hover);
  filter: brightness(1.08);
  border-color: var(--primary_color);
}
main .like-count {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 1em;
  color: var(--primary_strong_text_color);
}
main .like-count i {
  color: var(--primary_color);
}
main .topics ul {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  list-style: none;
  padding: 0;
  margin: 0;
}
main .topics .tag {
  background-color: var(--primary_color);
  color: #fff;
  padding: 5px 10px;
  border-radius: 5px;
  text-decoration: none;
  transition: transform 0.2s, background-color 0.2s;
}
main .topics .tag:hover {
  background-color: var(--primary_dark_color);
  transform: translateY(-2px);
}
main #basicshit {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  margin-bottom: 20px;
}
main #basicshit h1 {
  margin: 10px 0;
  padding: 0;
  font-size: 2.5em;
  color: var(--primary_strong_text_color);
}
main #basicshit img {
  max-width: 100%;
  max-height: 400px;
  margin: 10px 0;
  border-radius: 10px;
}
main #date {
  font-size: 1.2em;
  margin: 0;
  padding: 0;
  color: var(--primary_strong_text_color);
}
main .container {
  margin-top: 20px;
  padding: 20px;
  background: var(--background);
  border-radius: 16px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  text-align: center;
  border: none;
  margin-bottom: 24px;
}
main .container:last-child {
  margin-bottom: 0;
}
main #orginfo, main #infocontainer {
  border: none;
  box-shadow: 0 1px 8px rgba(0,0,0,0.04);
  background: var(--color-title-accent);
  border-radius: 0.7em;
  margin-bottom: 24px;
}
main .repeating-alert {
  border: none;
  box-shadow: none;
  background-color: var(--yellow);
  color: var(--black);
  padding: 1em;
  border-radius: 0.5em;
  text-align: center;
  margin-top: 1em;
}
main .repeating-alert strong {
  font-size: 1.2em;
  display: block;
}
main .display-all {
  display: block;
  margin-top: 0.5em;
}
#report-selection-btn {
  position: absolute;
  z-index: 2000;
  display: none;
  padding: 6px 14px;
  background: #ffc107;
  color: #222;
  border: none;
  border-radius: 5px;
  font-size: 1em;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  cursor: pointer;
  transition: background 0.2s;
  pointer-events: auto;
}
#report-selection-btn:hover {
  background: #ffdb5c;
}

#reminder-modal .modal-content {
  background: var(--color-card-bg);
  color: var(--color-text);
  border-radius: 1em;
  box-shadow: var(--box_shadow);
}
#reminder-modal .modal-header, #reminder-modal .modal-footer {
  background: var(--color-title-accent);
  color: var(--primary_color);
  border-top-left-radius: 1em;
  border-top-right-radius: 1em;
}
#reminder-modal .modal-title {
  color: var(--primary_color);
}
#reminder-modal .form-control {
  background: var(--background);
  color: var(--primary_text_color);
  border: 1px solid var(--primary_color);
}
#reminder-modal .form-control:focus {
  border-color: var(--primary_dark_color);
  box-shadow: 0 0 0 2px var(--primary_color);
}
#reminder-modal .button {
  background: var(--primary_color);
  color: #fff;
}
#reminder-modal .button:hover {
  background: var(--primary_dark_color);
}
/* Popup/modal base styles for all modals on the page */
.modal-content {
  background: var(--color-card-bg);
  color: var(--color-text);
  border-radius: 1em;
  box-shadow: var(--box_shadow);
}
.modal-header, .modal-footer {
  background: var(--color-title-accent);
  color: var(--primary_color);
  border-top-left-radius: 1em;
  border-top-right-radius: 1em;
}
.modal-title {
  color: var(--primary_color);
}
.form-control {
  background: var(--background);
  color: var(--primary_text_color);
  border: 1px solid var(--primary_color);
}
.form-control:focus {
  border-color: var(--primary_dark_color);
  box-shadow: 0 0 0 2px var(--primary_color);
}
.button, .btn-primary, .btn-warning, .btn-secondary {
  background: var(--primary_color) !important;
  color: #fff !important;
  border: none;
}
.button:hover, .btn-primary:hover, .btn-warning:hover, .btn-secondary:hover {
  background: var(--primary_dark_color) !important;
}
.alert-success, .alert-danger {
  color: var(--primary_text_color);
  background: var(--color-title-accent);
  border: 1px solid var(--primary_color);
}

.button-container.reminder-top {
  justify-content: flex-start;
  position: relative;
}


/* Ensure all modals are above the header */

</style>
{% endblock %}

{% block content %}
<div class="container-main-content">
  <!-- Loading overlay -->
  <div id="loading-overlay">
    <div class="loading-spinner"></div>
    <div style="font-size:1.2em; color:#333;">Ladataan...</div>
  </div>
  <!-- Make sure to include Font Awesome in your <head> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

  <style>
    /* Navigator Container */
    #navigator {
      left: -20px;
      top: -20px;
      position: fixed;
    }

    /* Button Styling */
    #navigator button {
      width: 10em;
      background: #333;
      color: #fff;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    #navigator button:hover {
      background: #444;

    }

    #navigator #prev-demo-button:hover {
      transform: translateX(-10px);

    }

    #navigator #next-demo-button:hover {
      transform: translateX(10px);
    }

    #navigator button:active {
      background: #333;
      transform: translateX(0);
    }

    #navigator button i {
      margin: 0 0.5em;
      font-size: 1.2em;
    }

    /* Fixed Previous Button */
    #prev-demo {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      width: max-content;
      z-index: 10;
    }

    /* Fixed Previous Button */
    #next-demo {
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      width: max-content;
      z-index: 10;
    }


    /* Remove Button Border if It's on the Same Line */
    #navigator button:focus {
      outline: none;
    }

    @media screen and (max-width: 768px) {

      /* Adjustments for smaller screens */
      #navigator {
        display: none;
      }

    }
  </style>

  <div id="navigator">
    <!-- Fixed Previous Button -->
    <div id="prev-demo">
      <button id="prev-demo-button">
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
    </div>

    <div id="next-demo">
      <!-- Next Button -->
      <button id="next-demo-button">
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>


  <!-- Report Error Modal -->
  <div class="modal fade" id="report-modal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportModalLabel">{{ _('Ilmoita virheestä') }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>{{ _('Jos huomaat virheen mielenosoituksen tiedoissa, voit ilmoittaa siitä alla olevalla lomakkeella.') }}</p>
          <form id="report-error-form" action="/report" method="POST" autocomplete="off">
            <label for="error" class="form-label">{{ _('Virheen kuvaus') }}</label>
            <textarea name="error" id="error" class="form-control" rows="4" required></textarea>
            <input type="hidden" name="type" value="demonstration">
            <input type="hidden" name="demo_id" value="{{ demo['_id'] }}">
            <span class="processing-indicator">
              <span style="display:inline-block;width:18px;height:18px;border:3px solid #fff;border-top:3px solid #ffc107;border-radius:50%;animation:spin 0.7s linear infinite;vertical-align:middle;"></span>
              <span style="color:#ffc107;">{{ _('Käsitellään...') }}</span>
            </span>
            <div id="report-error-result" style="margin-top:10px;"></div>
          </form>
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script>
          /**
           * Handles AJAX submission of the error report form.
           *
           * Parameters
           * ----------
           * None.
           *
           * Returns
           * -------
           * None.
           */
          $(function() {
            $("#report-error-form").on("submit", function(e) {
              e.preventDefault();
              var $form = $(this);
              $form.addClass("processing");
              $form.find('button[type="submit"]').prop("disabled", true);
              $form.find(".processing-indicator").show();
              $("#report-error-result").empty();

              $.ajax({
                url: $form.attr("action"),
                method: $form.attr("method"),
                data: $form.serialize(),
                success: function(response) {
                  // Show thank you and countdown
                  var seconds = 3;
                  $("#report-error-result").html(
                    '<div class="alert alert-success">{{ _("Kiitos ilmoituksesta!") }}<br>' +
                    '<span id="report-close-countdown">' + seconds + '</span> {{ _("s kuluttua ikkuna sulkeutuu.") }}</div>'
                  );
                  $form[0].reset();
                  // Countdown and close modal
                  var interval = setInterval(function() {
                    seconds -= 1;
                    $("#report-close-countdown").text(seconds);
                    if (seconds <= 0) {
                      clearInterval(interval);
                      var modal = bootstrap.Modal.getInstance(document.getElementById("report-modal"));
                      if (modal) modal.hide();
                    }
                  }, 1000);
                },
                error: function(xhr) {
                  $("#report-error-result").html('<div class="alert alert-danger">{{ _("Virhe lähetyksessä. Yritä uudelleen.") }}</div>');
                },
                complete: function() {
                  $form.removeClass("processing");
                  $form.find('button[type="submit"]').prop("disabled", false);
                  $form.find(".processing-indicator").hide();
                }
              });
            });
            // Hide processing indicator initially
            $("#report-error-form .processing-indicator").hide();
          });
          </script>
        </div>
        <div class="modal-footer">
          <button type="submit" form="report-error-form" class="btn btn-primary">{{ _('Lähetä') }}</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _('Peruuta') }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Past Demonstration Modal -->
  <div class="modal fade" id="past-demo-modal" tabindex="-1" aria-labelledby="pastDemoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pastDemoModalLabel">{{ _('Huomio') }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>{{ _('Tämä mielenosoitus on jo menneisyydessä.') }}</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _('Sulje') }}</button>
        </div>
      </div>
    </div>
  </div>

  <main id="main">
    <div class="button-container" style="margin-bottom: 1.2em;">
      <button class="button btn btn-warning" data-bs-toggle="modal" data-bs-target="#report-modal">
        <i class="fa fa-question-circle"></i> {{ _('Ilmoita virheestä') }}
      </button>
    </div>
    <!-- IMAGE -->
    {% if demo['img'] and demo['img'] !=
    "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAJQAlAMBIgACEQEDEQH/xAAcAAEBAQADAQEBAAAAAAAAAAAAAQIDBAYHBQj/xAA8EAACAQIDAggMBAcAAAAAAAAAAQIDEQQFBkHRBxIhUVVhkbITFBYXIjE1VHF0kpRCgaHwIyQyM2LC4f/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDxgAAAAAAAAAAAoAgKAIAAAAAAAAAAAAAAAAUFQAFsVICWFjdhYDFiHJYlgMWIbaM2AyCsgAAAAAAAAApCgVFSCRtARI0kVI2kBmwsbSLYDjaFjksSwHE0ZaOVowwOMyzkaMMDIKyAAAAAAFKiFQGkjaRmJvYwP2sBpfPMww0MTg8sr1aE+WE/RSl1q7R2lorUnRFb6obz1euM4zLKMq03HLMZUwqq4SXHVNL0rRp29a632nlFrDUfTGI7I7gL5F6j6JrfVDeXyM1H0TW+qG8eV+oul8R2R3F8rtRdL4jsjuAnkXqPomt9UN5HovUfRNb6obz9bJcZrbPVUlluPxE4U3aVSThGKfNdr1nQzXUOrcrxFXC43MsVRr01yxah+TTtyrrA8/mGBxWX4mWGx2HqUK8Um4TVnZ7TqNH0HhgSWc4BpevC/wCzPAMDiaMM5JGGBghSAAAAAAFRpGUaQG4m/wALMRNbGB9B4TPZelvlJ92kfj6M0zV1Fj+LLjQwVFp16q7q63+i/I9ZqnI8Vn8dKYPCK0fFJurVa9GlHi0uV9fMtvae6yjLMLlGX0sFgqfEpU1t9cntbe1sDw2tdC4elgPHsioOEqEf4tCLcuPFbVe/KubafN0f0cfKuETSniFWeb5dT/lKjvXpxX9qT/Ev8X+j6nyB2+DvVOV5blc8vzGssNOFWU41JJ2mn1rb/wAPNcIed4XPc3dbApuhRo+DVRqzm7t3+HKdrRekKuf1PGcZx6OXwf8AVHklVfNHq53+1rXGiauTUamNy3wlbAcX01LlnR+PPHr7ecDtcMHtjAfKvvM8BI9/wwe2MB8q+8z5+wMMwzbMMDDMmmZAAAAAABpEKgNpm78j+BxpmtgH9IZJ7GwHy1Puo7x4LIeEXI6eUYSljZ1qFelSjTnBUnJXStdNbDv+cfTXvVb7ee4D1xirShWpTpVYxnTnFxlGSumn60zyvnG0371W+3nuL5xdN+9Vvt57gPUUKNPD0oUaMIwpQSjCEVZRS2I1OKnFxkk01Zpq6Z5Tzi6b96rfbz3EfCNpv3qt9vPcB5Thh5M5wHyz7zPn7PTa/wBQ4bUGb06uCjPwFCl4OM5qzm73btsR5ZsCSMMrZlgZIVkAAAAAABSADSNpmCoDkTNJnEmaTA5bjjHGpFuBu5LmbkbArZlsjZGwFzLFyMAQAAAAAAAAAAW5ABq5UZFwN3LcwANNi5kXAtyEuABAAAAAAAAAAAAAAAAAAKCACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/Z"
    %}
    <img src="{{ demo['img'] }}" alt="Event Image" />
    {% endif %}

    {% if demo.cover_picture and not demo.cover_picture == 'None' %}
    <div class="demo-cover-picture">
      <img src="{{ demo.cover_picture }}" alt="Cover Photo" style="width:100%;max-height:350px;object-fit:cover;">
    </div>
    {% endif %}

    <div id="basicshit">
      <h1>{{ demo['title'] }}</h1>
      <p id="date">
        {{ demo['date'] | date('%d.%m.%Y') }} {{ _('klo') }} {{ demo['start_time'] | time('%H:%M') }} - {{
        demo['end_time'] | time('%H:%M') }}
      </p>
    </div>

    <div class="button-container" style="gap: 10px; flex-wrap: wrap;">
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}"
      target="_blank" class="button btn btn-primary" style="display: flex; align-items: center; gap: 0.5em;">
      <i class="fab fa-facebook-f"></i> {{ _('Jaa Facebookissa') }}
      </a>
      <a href="https://twitter.com/intent/tweet?url={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}&text={{ demo['title'] }}"
      target="_blank" class="button btn btn-primary" style="display: flex; align-items: center; gap: 0.5em;">
      <i class="fab fa-x-twitter"></i> {{ _('Jaa Xssä') }}
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}&title={{ demo['title'] }}"
      target="_blank" class="button btn btn-primary" style="display: flex; align-items: center; gap: 0.5em;">
      <i class="fab fa-linkedin-in"></i> {{ _('Jaa LinkedInissä') }}
      </a>
      <a href="{{ url_for('download_material', demo_id=demo['_id']) }}" class="button btn btn-primary" style="display: flex; align-items: center; gap: 0.5em;">
      <i class="fas fa-download"></i> {{ _('Lataa graafinen materiaali') }}
      </a>
      <button class="button btn btn-primary" id="open-reminder-btn" style="display: flex; align-items: center; gap: 0.5em;">
      <i class="fas fa-bell"></i> {{ _('Tilaa muistutus sähköpostiisi') }}
      </button>
    </div>

    <div class="button-container">
      <button id="like-button" class="button like-button" onclick="toggleLike('{{ demo['_id'] }}')" aria-pressed="false">
        <i class="fas fa-thumbs-up"></i> <span id="like-btn-text">{{ _('Osallistun') }}</span>
      </button>
      <div class="like-count">
        <p>{{ _('Osallistuu:') }}</p>
        <i class="fas fa-thumbs-up"></i>
        <p id="like-count" style="margin: 0; padding: 0;">{{ demo['likes'] }}</p>
      </div>
    </div>
    <script>
      /**
       * Gets a cookie value by name.
       *
       * Parameters
       * ----------
       * name : str
       *     Cookie name.
       *
       * Returns
       * -------
       * str or undefined
       */
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }

      let liked = getCookie(`liked_{{ demo._id }}`) === 'true';
      let likeRequestInProgress = false;

      /**
       * Toggles the like state for the demonstration.
       *
       * Parameters
       * ----------
       * demoId : str
       *     The demonstration id.
       *
       * Returns
       * -------
       * None.
       */
      function toggleLike(demoId) {
        if (likeRequestInProgress) return;
        likeRequestInProgress = true;
        const likeButton = document.getElementById("like-button");
        const likeBtnText = document.getElementById("like-btn-text");
        likeButton.disabled = true;
        likeButton.classList.add("processing");
        likeBtnText.textContent = "{{ _('Käsitellään...') }}";

        const url = liked ? `/api/demo/${demoId}/unlike` : `/api/demo/${demoId}/like`;
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("like-count").innerText = data.likes;
            liked = !liked;
            document.cookie = `liked_${demoId}=${liked}; path=/`;
            // Update button state
            likeButton.setAttribute("aria-pressed", liked ? "true" : "false");
            if (liked) {
              likeButton.classList.add("liked");
            } else {
              likeButton.classList.remove("liked");
            }
          })
          .catch((error) => {
            console.error('Error:', error);
          })
          .finally(() => {
            likeRequestInProgress = false;
            likeButton.disabled = false;
            likeButton.classList.remove("processing");
            likeBtnText.textContent = "{{ _('Osallistun') }}";
          });
      }

      /**
       * Fetches the current like count and updates the UI.
       *
       * Parameters
       * ----------
       * demoId : str
       *     The demonstration id.
       *
       * Returns
       * -------
       * None.
       */
      function get_likes(demoId) {
        fetch(`/api/demo/${demoId}/likes`)
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("like-count").innerText = data.likes;
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      }

      document.addEventListener("DOMContentLoaded", () => {
        get_likes("{{ demo['_id'] }}");
        // Set initial button state
        const likeButton = document.getElementById("like-button");
        likeButton.setAttribute("aria-pressed", liked ? "true" : "false");
        if (liked) {
          likeButton.classList.add("liked");
        }
      });
    </script>

    <hr style="margin: 20px 0;">

    <div class="topics">
      <ul>
        {% if demo["tags"] and demo["tags"]|length > 0 %}
        {% for tag in demo["tags"] %}
        <li>
          <a style="margin: 0; padding: 0;" href="{{ url_for('tag_detail', tag_name=tag) }}">
            <span class="tag">#{{ tag }}</span>
          </a>
        </li>
        {% endfor %}
        {% endif %}
      </ul>
    </div>

    {% if demo['description'] %}
    <div class="container">
      <h2 class="subtitle">{{ _('Mielenosoituksen esittelyteksti') }}</h2>
      {{ demo['description']|safe }}
    </div>
    {% endif %}

    <div class="countdown">
      <h2 class="subtitle">{{ _('Aikaa mielenosoituksen alkuun') }}</h2>
      <div id="timer" style="font-size: 24px; color: var(--primary_strong_text_color)"></div>
    </div>

    <div class="container mt-4">
      <h2 class="subtitle text-center">{{ _('Sijainti') }}</h2>
      <p class="text-center">{{ demo['address'] }}, {{ demo['city'] }}</p>
      {% if demo['route'] and demo['route'] != 'None' %}
      <div class="route mt-3">
        <p><strong>{{ _('Marssin reitti:') }}</strong></p>
        {% if demo['route'] is string %}
        <p>{{ demo['route'] }}</p>
        {% elif demo['route'] is iterable %}
        <ol class="list-group list-group-numbered">
          {% for step in demo['route'] %}
          <li class="list-group-item">{{ step }}</li>
          {% endfor %}
        </ol>
        {% endif %}
      </div>
      {% endif %}
      <div class="map mt-4">
        <div id="map-container" style="position:relative;">
          <div id="map" class="rounded shadow" style="height: 300px;"></div>
        </div>
      </div>
    </div>

    <div id="subcontainer1">
      {% if demo['facebook'] or demo['recurring'] %}
      <div id="infocontainer">
        <h2 class="subtitle">{{ _('Lisätiedot') }}</h2>
        <div id="demo-details">
          {% if demo['facebook'] %}
          <a class="action-button facebook-button" href="{{ demo['facebook'] }}" target="_blank">
            {{ _('Facebook-tapahtuma') }} <i class="fas fa-external-link-alt"></i>
          </a>
          {% endif %}
        </div>
        {% if demo["recurring"] and demo['repeat_schedule'] %}
        <div class="repeating-alert">
          <strong>Mielenosoitus toistuu säännöllisesti</strong><br>
          {{ generate_demo_sentence(demo) }}
          <br>
          <a href="{{ url_for('siblings_meeting', parent=demo['parent']) }}" class="button display-all">
            <i class="fas fa-arrow-right"></i> {{ _('Näytä seuraavat') }}
          </a>
        </div>
        {% endif %}
      </div>
      {% endif %}

      <div id="orginfo">
        <h2 class="subtitle">{{ _('Järjestäjät') }}</h2>
        <div class="organizers-list" id="organizers-list">
          {% if demo['organizers'] and demo['organizers']|length > 0 %}
          {% for org in demo['organizers'] %}
          <div class="organizer-info">
            <p><strong>{{ _('Nimi:') }}</strong><br />{{ org.name }}</p>
            {% if org.organization_id and org.organization_id != "None" %}
            <a href="{{ org.url if org.url else '#' }}" class="org-profile-link">
              {{ _('Mielenosoitukset.fi -profiili') }}
            </a>
            {% endif %}
            {% if org.website %}
            <p>
              <strong>{{ _('Verkkosivut:') }}</strong><br />
              <a href="{{ org.website }}" target="_blank" class="org-website">{{ org.website }}</a>
            </p>
            {% endif %}
            {% if org.email %}
            <p>
              <strong>{{ _('Sähköpostiosoite:') }}</strong><br />
              <a href="mailto:{{ org.email }}" class="org-email">{{ org.email }}</a>
            </p>
            {% endif %}
          </div>
          {% endfor %}
          {% else %}
          <p id="no-organizers">{{ _('Ei järjestäjätietoja saatavilla.') }}</p>
          {% endif %}
        </div>
      </div>

      <div class="button-container">
        {% if request.referrer is defined %}
        <a class="back-link" href="{{ request.referrer }}">{{ _('Takaisin edelliselle sivulle') }}</a>
        {% endif %}
        <a class="back-link" href="{{ url_for('demonstrations') }}">{{ _('Takaisin kaikkiin mielenosoituksiin') }}</a>
      </div>
    </div>
    <button id="report-selection-btn" type="button">{{ _('Ilmoita virheestä tästä kohdasta') }}</button>

   
    <div class="modal fade" id="reminder-modal" tabindex="-1" aria-labelledby="reminderModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reminderModalLabel">{{ _('Tilaa muistutus sähköpostiisi') }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="reminder-form" method="POST" action="{{ url_for('subscribe_reminder', demo_id=demo['_id']) }}">
              <input type="email" name="user_email" class="form-control" placeholder="Sähköpostiosoite" required style="margin-bottom:10px;">
              <button type="submit" class="button">{{ _('Tilaa muistutus') }}</button>
            </form>
            <div id="reminder-result" style="margin-top:10px;"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
    document.getElementById('open-reminder-btn').addEventListener('click', function() {
      var modal = new bootstrap.Modal(document.getElementById('reminder-modal'));
      modal.show();
    });
    document.getElementById('reminder-form').addEventListener('submit', function(e) {
      e.preventDefault();
      var form = this;
      var formData = new FormData(form);
      fetch(form.action, {method: 'POST', body: formData})
        .then(r => r.json())
        .then(data => {
          document.getElementById('reminder-result').innerHTML = data.message;
          if(data.status === 'OK') form.reset();
        })
        .catch(() => {
          document.getElementById('reminder-result').innerHTML = 'Virhe tilauksessa.';
        });
    });
    </script>
  </main>
</div>
{% endblock %}

{% block scripts %}
<script>
  /**
   * Checks if the demonstration date is in the past and shows a warning popup.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  document.addEventListener("DOMContentLoaded", () => {
    const demoDate = new Date("{{ demo['date'] }}T{{ demo['start_time'] if demo['start_time'] else '00:00:00' }}");
    const now = new Date();

    if (demoDate < now) {
      const pastDemoModal = new bootstrap.Modal(document.getElementById("past-demo-modal"));
      pastDemoModal.show();
    }
  });

  /**
   * Closes the past demonstration modal.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  function closePastDemoModal() {
    document.getElementById("past-demo-modal").classList.remove("active");
    document.getElementById("overlay").classList.remove("active");
  
  }
</script>
<script>
  /**
   * Updates the countdown to the event using ISO-8601 date.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  function updateCountdown() {
    const demoDate = data.demo.date; // ISO-8601 format (yyyy-mm-dd)
    const demoTime = data.demo.start_time;
    const demoEnds = data.demo.end_time;
    // Directly combine ISO-8601 date and time
    const eventDateStr = `${demoDate}T${demoTime}`;
    const eventDate = new Date(eventDateStr);
    const now = new Date();
    const timeRemaining = eventDate - now;
    const time_until_end = new Date(`${demoDate}T${demoEnds}`) - now;
    const timerElement = document.getElementById("timer");

    if (timeRemaining <= 0 && time_until_end >= 0) { // Event is ongoing
      timerElement.innerText = "{{ _('Mielenosoitus on käynnissä!') }}";
      return;
    }

    if (time_until_end <= 0) {
      timerElement.innerText = "{{ _('Mielenosoitus on päättynyt.') }}";
      return;
    }

    const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

    timerElement.innerText = `${days} {{ _('päivää') }} ${hours} {{ _('tuntia') }} ${minutes} {{ _('minuuttia') }} ${seconds} {{ _('sekuntia') }}`;
  }

  setInterval(updateCountdown, 1000);

</script>


<!-- Leaflet JS and Map Integration -->
<script src="{{ url_for('static', filename='leaflet/leaflet.js') }}"></script>
<script>// Data initialization
  const data = {
    demo: {{ demo | tojson }}
  };

  // Map Initialization if location data is available
  if (data.demo.latitude && data.demo.longitude) {
    const map = L.map("map").setView([data.demo.latitude, data.demo.longitude], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    L.marker([data.demo.latitude, data.demo.longitude])
      .addTo(map)
      .bindPopup(data.demo.address)
      .openPopup();
  } else {
    const mapElement = document.getElementById("map");
    if (mapElement) {
      mapElement.remove();
    }
  }

  // Toggle display for toolbox buttons
  function toggleToolbox() {
    const toolboxButtons = document.getElementById("toolbox-buttons");
    toolboxButtons.style.display = toolboxButtons.style.display === 'none' ? 'flex' : 'none';
  }
</script>
<script>
  let demoId = "{{ demo['_id'] }}";
</script>
<script src="{{ url_for('static', filename='js/admin_demo_info.js') }}"></script>
<!--<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css' )}}">-->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Retrieve the demo list from localStorage.
    const demoListStr = localStorage.getItem("demoList");
    if (!demoListStr) {
      console.warn("No demo list found in localStorage.");
      $("#prev-demo-button").remove();
      $("#next-demo-button").remove();
      return;
    }
    const demoList = JSON.parse(demoListStr);

    // Get the current page URL path.
    const currentUrl = window.location.pathname;

    // Find the index of the demo in the list that matches the current URL.
    const currentIndex = demoList.findIndex(demo => demo.url === currentUrl);

    if (currentIndex !== -1) {
      const currentDemo = demoList[currentIndex];
      console.log("Current demo ID:", currentDemo.id);

      // Optionally, display the current demo ID on the page.
      const outputEl = document.getElementById("demo-id-output");
      if (outputEl) {
        outputEl.textContent = "Demo ID: " + currentDemo.id;
      }

      // Determine the previous and next demos.
      const previousDemo = currentIndex > 0 ? demoList[currentIndex - 1] : null;
      const nextDemo = currentIndex < demoList.length - 1 ? demoList[currentIndex + 1] : null;

      // Store the previous and next demo objects globally if needed.
      window.previousdemo = previousDemo;
      window.nextdemo = nextDemo;

      console.log("Previous demo:", previousDemo);
      console.log("Next demo:", nextDemo);

      // Optionally, wire up navigation buttons if they exist.
      const prevButton = document.getElementById("prev-demo-button");
      if (prevButton) {
        if (previousDemo) {
          prevButton.addEventListener("click", () => {
            window.location.href = previousDemo.url;
          });
        } else {
          prevButton.style.display = "none"; // Hide if no previous demo.
        }
      }

      const nextButton = document.getElementById("next-demo-button");
      if (nextButton) {
        if (nextDemo) {
          nextButton.addEventListener("click", () => {
            window.location.href = nextDemo.url;
          });
        } else {
          nextButton.style.display = "none"; // Hide if no next demo.
        }
      }
    } else {
      console.warn("No matching demo found for URL:", currentUrl);
    }
  });
</script>

<script>
  /**
   * Initializes modal functionality for the "Report Error" button.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  document.addEventListener("DOMContentLoaded", () => {
    const reportButton = document.querySelector("[data-modal-target='#report-modal']");
    const overlay = document.getElementById("overlay");
    const reportModal = document.getElementById("report-modal");

    // Open modal function
    reportButton.addEventListener("click", () => {
      reportModal.classList.add("active");
      overlay.classList.add("active");
    });

    // Close modal function
    const closeButtons = document.querySelectorAll("[data-close-modal]");
    closeButtons.forEach((button) =>
      button.addEventListener("click", () => {
        reportModal.classList.remove("active");
        overlay.classList.remove("active");
      })
    );

    overlay.addEventListener("click", () => {
      reportModal.classList.remove("active");
      overlay.classList.remove("active");
    });
  });
</script>
<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"  crossorigin="anonymous"></script>
<script>
  /**
   * Initializes the "Past Demonstration" modal if the event is in the past.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  document.addEventListener("DOMContentLoaded", () => {
    const demo_date = new Date("{{ demo['date'] }}T{{ demo['start_time'] if demo['start_time'] else '00:00:00' }}");
    const now = new Date();

    if (demo_date < now) {
      const past_demo_modal = new bootstrap.Modal(document.getElementById("past-demo-modal"));
      past_demo_modal.show();
    }
  });
</script>
<script>
  /**
   * Hides the loading overlay when the DOM is ready.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  document.addEventListener("DOMContentLoaded", function() {
    var overlay = document.getElementById("loading-overlay");
    if (overlay) {
      overlay.classList.add("hidden");
      setTimeout(function() {
        overlay.style.display = "none";
      }, 400);
    }
  });
</script>
<script>
  /**
   * Shows a loading spinner overlay on top of the given element.
   *
   * Parameters
   * ----------
   * element_id : str
   *     The id of the element to overlay.
   *
   * Returns
   * -------
   * None.
   */
  function showElementLoading(element_id) {
    /**
    Displays a loading spinner overlay on the specified element.

    Parameters
    ----------
    element_id : str
        The id of the element to overlay.

    Returns
    -------
    None
    */
    var el = document.getElementById(element_id);
    if (!el) return;
    // Prevent duplicate overlays
    if (el.querySelector('.element-loading-overlay')) return;
    var overlay = document.createElement('div');
    overlay.className = 'element-loading-overlay';
    var spinner = document.createElement('div');
    spinner.className = 'element-loading-spinner';
    overlay.appendChild(spinner);
    // Ensure parent is positioned
    if (getComputedStyle(el).position === 'static') {
      el.style.position = 'relative';
    }
    el.appendChild(overlay);
  }

  /**
   * Hides the loading spinner overlay from the given element.
   *
   * Parameters
   * ----------
   * element_id : str
   *     The id of the element to remove overlay from.
   *
   * Returns
   * -------
   * None.
   */
  function hideElementLoading(element_id) {
    /**
    Removes the loading spinner overlay from the specified element.

    Parameters
    ----------
    element_id : str
        The id of the element to remove overlay from.

    Returns
    -------
    None
    */
    var el = document.getElementById(element_id);
    if (!el) return;
    var overlay = el.querySelector('.element-loading-overlay');
    if (overlay) el.removeChild(overlay);
  }
</script>
<script>
  // Example usage for the map: show spinner until map is loaded
  document.addEventListener("DOMContentLoaded", function() {
    showElementLoading('map-container');
  });
  window.addEventListener('load', function() {
    hideElementLoading('map-container');
  });
</script>
<script>
  // ...existing code...

  /**
   * Shows processing state for the error report form.
   *
   * Parameters
   * ----------
   * None.
   *
   * Returns
   * -------
   * None.
   */
  document.addEventListener("DOMContentLoaded", function() {
    var reportForm = document.getElementById("report-error-form");
    if (reportForm) {
      reportForm.addEventListener("submit", function(e) {
        // Show processing state
        reportForm.classList.add("processing");
        // Optionally, prevent double submit
        var submitBtn = reportForm.querySelector('button[type="submit"]');
        if (submitBtn) submitBtn.disabled = true;
      });
    }
  });
</script>
<script>
/**
 * Shows a floating "report error" button when user selects text.
 *
 * Parameters
 * ----------
 * None.
 *
 * Returns
 * -------
 * None.
 */
document.addEventListener("DOMContentLoaded", function() {
  const reportBtn = document.getElementById("report-selection-btn");
  let selectedText = "";

  function showReportBtnAtSelection() {
    const selection = window.getSelection();
    selectedText = selection && selection.toString().trim();
    if (selectedText && selection.rangeCount > 0) {
      const range = selection.getRangeAt(0);
      const rect = range.getBoundingClientRect();
      // Only show if selection is in main content
      const main = document.getElementById("main");
      // Check if anchorNode is inside main
      let node = selection.anchorNode;
      let insideMain = false;
      while (node) {
        if (node === main) {
          insideMain = true;
          break;
        }
        node = node.parentNode;
      }
      if (insideMain) {
        reportBtn.style.display = "block";
        reportBtn.style.position = "absolute";
        // Position button above selection, or below if near top
        const scrollY = window.scrollY || window.pageYOffset;
        const scrollX = window.scrollX || window.pageXOffset;
        let top = rect.top + scrollY - reportBtn.offsetHeight - 8;
        if (top < 0) {
          top = rect.bottom + scrollY + 8;
        }
        reportBtn.style.top = top + "px";
        reportBtn.style.left = (rect.left + scrollX) + "px";
      } else {
        reportBtn.style.display = "none";
      }
    } else {
      reportBtn.style.display = "none";
    }
  }

  document.addEventListener("mouseup", function(e) {
    setTimeout(showReportBtnAtSelection, 10);
  });

  // Hide button on scroll or click elsewhere
  document.addEventListener("scroll", function() {
    reportBtn.style.display = "none";
  });
  document.addEventListener("mousedown", function(e) {
    if (!reportBtn.contains(e.target)) {
      reportBtn.style.display = "none";
    }
  });

  // When user clicks the floating report button, open modal and prefill error field
  reportBtn.addEventListener("click", function() {
    var modal = bootstrap.Modal.getOrCreateInstance(document.getElementById("report-modal"));
    modal.show();
    var textarea = document.getElementById("error");
    if (textarea && selectedText) {
      textarea.value = "{{ _('Virheellinen kohta:') }}\n" + selectedText + "\n\n";
      textarea.focus();
    }
    reportBtn.style.display = "none";
    window.getSelection().removeAllRanges();
  });
});
</script>
{% endblock %}