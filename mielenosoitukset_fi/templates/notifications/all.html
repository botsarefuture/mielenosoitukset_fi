{% extends "base.html" %}
{% block title %}{{ _('Ilmoitukset') }}{% endblock %}

{% block content %}
<h1 class="mb-3">{{ _('Kaikki ilmoitukset') }}</h1>

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span class="fw-semibold">{{ _('Ilmoitukset') }}</span>

    {# Optional: mark all as read button (only shown if there are unread) #}
    {% if notifications|selectattr('read', 'equalto', False)|list %}
    <form method="post"
          action="{{ url_for('notifications.mark_all_read') }}"
          class="m-0 p-0">
      <button type="submit"
              class="btn btn-link btn-sm text-decoration-none">
        {{ _('Merkitse kaikki luetuiksi') }}
      </button>
    </form>
    {% endif %}
  </div>

  <div class="list-group list-group-flush">
    {% for n in notifications %}
      {% set is_unread = (not n.read) %}
      {% set icon_class = n.icon or 'fa-solid fa-info-circle' %}

      {% if n.link %}
        <a href="{{ n.link }}"
           class="list-group-item list-group-item-action d-flex gap-2 align-items-start {{ 'bg-light' if is_unread }}">
          <div class="pt-1">
            <i class="{{ icon_class }} fa-lg {{ 'text-primary' if is_unread else 'text-secondary' }}"></i>
          </div>
          <div class="flex-grow-1">
            <div class="small {{ 'fw-semibold' if is_unread }}">{{ n.message }}</div>
            <div class="text-muted small">
              {{ n.created_at|datetimeformat('%d.%m.%Y %H:%M') }}
            </div>
          </div>
        </a>
      {% else %}
        <div class="list-group-item d-flex gap-2 align-items-start {{ 'bg-light' if is_unread }}">
          <div class="pt-1">
            <i class="{{ icon_class }} fa-lg {{ 'text-primary' if is_unread else 'text-secondary' }}"></i>
          </div>
          <div class="flex-grow-1">
            <div class="small {{ 'fw-semibold' if is_unread }}">{{ n.message }}</div>
            <div class="text-muted small">
              {{ n.created_at|datetimeformat('%d.%m.%Y %H:%M') }}
            </div>
          </div>
        </div>
      {% endif %}
    {% else %}
      <div class="list-group-item text-center text-muted">
        {{ _('Ei ilmoituksia') }}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
