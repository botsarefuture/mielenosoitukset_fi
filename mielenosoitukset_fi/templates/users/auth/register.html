{% extends 'base.html' %}

{% block title %}Rekisteröidy{% endblock %}

{% block styles %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/v2/auth.css') }}">
{% endblock %}

{% block content %}
<div class="auth-wrapper">
    <div class="auth-container">
        <div class="auth-header">
            <div class="auth-icon">
                <i class="fa-solid fa-user-plus"></i>
            </div>
            <h1>{{ _('Rekisteröidy') }}</h1>
            <p class="auth-subtitle">{{ _('Luo uusi tili jatkaaksesi') }}</p>
        </div>

        <form id="register-form" action="{{ url_for('users.auth.register') }}" method="POST">
            <!-- Username -->
            <div class="form-group">
                <label class="form-label" for="username">
                    <i class="fa-solid fa-user"></i>
                    {{ _('Käyttäjätunnus') }}
                </label>
                <div class="form-input-wrapper">
                    <i class="fa-solid fa-user form-input-icon"></i>
                    <input type="text" 
                           id="username" 
                           name="username" 
                           required 
                           minlength="3" 
                           class="form-input"
                           placeholder="{{ _('Syötä käyttäjätunnus') }}"
                           autocomplete="username">
                </div>
                <div id="username-status" class="password-match"></div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label class="form-label" for="email">
                    <i class="fa-solid fa-envelope"></i>
                    {{ _('Sähköposti') }}
                </label>
                <div class="form-input-wrapper">
                    <i class="fa-solid fa-envelope form-input-icon"></i>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           required 
                           class="form-input"
                           placeholder="{{ _('Syötä sähköpostisi') }}"
                           autocomplete="email">
                </div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label class="form-label" for="password">
                    <i class="fa-solid fa-lock"></i>
                    {{ _('Salasana') }}
                </label>
                <div class="form-input-wrapper">
                    <i class="fa-solid fa-lock form-input-icon"></i>
                    <input type="password" 
                           id="password" 
                           name="password" 
                           required 
                           minlength="12" 
                           class="form-input"
                           placeholder="{{ _('Syötä salasana') }}"
                           autocomplete="new-password">
                    <button type="button" 
                            class="password-toggle" 
                            onclick="togglePasswordField('password')"
                            aria-label="{{ _('Näytä/piilota salasana') }}">
                        <i class="fa-solid fa-eye" id="password-toggle-icon"></i>
                    </button>
                </div>
                <div class="strength-meter">
                    <div id="strength-fill" class="strength-meter-fill"></div>
                </div>
                <div id="pwd-now-missing" class="password-match"></div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label class="form-label" for="password_confirm">
                    <i class="fa-solid fa-lock"></i>
                    {{ _('Vahvista salasana') }}
                </label>
                <div class="form-input-wrapper">
                    <i class="fa-solid fa-lock form-input-icon"></i>
                    <input type="password" 
                           id="password_confirm" 
                           name="password_confirm" 
                           required 
                           class="form-input"
                           placeholder="{{ _('Vahvista salasana') }}"
                           autocomplete="new-password">
                    <button type="button" 
                            class="password-toggle" 
                            onclick="togglePasswordField('password_confirm')"
                            aria-label="{{ _('Näytä/piilota salasana') }}">
                        <i class="fa-solid fa-eye" id="password_confirm-toggle-icon"></i>
                    </button>
                </div>
                <div id="password-match-message" class="password-match">
                    {{ _('Salasanat eivät täsmää') }}
                </div>
            </div>

            <!-- Password requirements -->
            <div class="password-requirements-container">
                <p class="password-requirements">{{ _('Salasanan on täytettävä seuraavat vaatimukset:') }}</p>
                <ul class="password-requirements">
                    <li id="req-length">{{ _('Vähintään 12 merkkiä pitkä') }}</li>
                    <li id="req-complex">{{ _('Sisältää vähintään 3 seuraavista: pieni kirjain, iso kirjain, numero, erikoismerkki') }}</li>
                    <li id="req-no-username">{{ _('Ei saa sisältää käyttäjätunnusta tai sähköpostia') }}</li>
                </ul>
            </div>

            <button type="button" id="generate-password" class="btn btn-secondary mb-2">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                {{ _('Luo salasana') }}
            </button>
            
            <button type="submit" class="btn btn-primary">
                <i class="fa-solid fa-user-plus"></i>
                {{ _('Rekisteröidy') }}
            </button>
        </form>

        <div class="auth-divider">
            <span>{{ _('tai') }}</span>
        </div>

        <div class="register-prompt">
            <p>{{ _('Onko sinulla jo tili?') }}</p>
            <a href="{{ url_for('users.auth.login') }}" class="btn btn-secondary">
                <i class="fa-solid fa-right-to-bracket"></i>
                {{ _('Kirjaudu sisään') }}
            </a>
        </div>
    </div>
</div>

<script>
// Toggle individual password field visibility
function togglePasswordField(fieldId) {
    const input = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '-toggle-icon');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Toggle all password fields (legacy function for compatibility)
function togglePassword() {
    ['password', 'password_confirm'].forEach(id => {
        togglePasswordField(id);
    });
}

// Add smooth animations on form submission
document.getElementById('register-form').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
});

// Focus on first input on page load
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('username').focus();
});

// Add shake animation on invalid input
document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('invalid', function() {
        this.classList.add('error');
        this.parentElement.style.animation = 'shake 0.5s';
        setTimeout(() => {
            this.classList.remove('error');
            this.parentElement.style.animation = '';
        }, 500);
    });
});

// Remove error class on input
document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('input', function() {
        this.classList.remove('error');
    });
});
</script>

<!-- Keep your existing JS for strength, matching, username check, generate password -->
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}