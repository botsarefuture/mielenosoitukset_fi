{% extends 'admin_base.html' %}

{% block main_content %}
<!-- Include CSS and JS files -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/demo_form.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/demo_checkbox.css') }}">
<script src="{{ url_for('static', filename='js/admin_demo_checkbox.js') }}"></script>

<!-- Main content container -->
<div class="container container-form">
    <h2>Muokkaa mielenosoitusta</h2>
    <form method="POST" action="{{ url_for('admin_demo.edit_demo', demo_id=demo._id) }}">

        <!-- Form fields -->
        <div class="form-group">
            <label for="title">Otsikko</label>
            <input type="text" id="title" name="title" class="form-control" value="{{ demo.title }}" required>
        </div>
        <div class="form-group">
            <label for="date">Päivämäärä (pp.kk.vvvv)</label>
            <input type="text" id="date" name="date" class="form-control" value="{{ demo.date }}" required>
        </div>
        <div class="form-group">
            <label for="start_time">Alkamisaika</label>
            <input type="time" id="start_time" name="start_time" class="form-control" value="{{ demo.start_time }}"
                required>
        </div>
        <div class="form-group">
            <label for="end_time">Päättymisaika</label>
            <input type="time" id="end_time" name="end_time" class="form-control" value="{{ demo.end_time }}" required>
        </div>
        <div class="form-group">
            <label for="topic">Aihe</label>
            <input type="text" id="topic" name="topic" class="form-control" value="{{ demo.topic }}" required>
        </div>
        <div class="form-group">
            <label for="facebook">Facebook linkki</label>
            <input type="url" id="facebook" name="facebook" class="form-control" value="{{ demo.facebook }}">
        </div>

        <!-- Paikkakunta Selector -->
        <div class="form-group">
            <label for="city">Paikkakunta</label>
            <div class="dropdown">
                <button type="button" class="dropbtn">{{ demo.city }}</button>
                <br>
                <div id="dropdown-content" class="dropdown-content">
                    <input type="text" placeholder="Hae paikkakunta..." id="searchInput" onkeyup="filterFunction()">
                    <!-- List of cities -->
                    {% for city in ['Akaa', 'Alajärvi', 'Alavieska', 'Alavus', 'Asikkala', 'Askola', 'Aura', 'Brändö', 'Eckerö', 'Enonkoski', 'Enontekiö', 'Espoo', 'Eura', 'Eurajoki', 'Evijärvi', 'Finström', 'Forssa', 'Föglö', 'Geta', 'Haapajärvi', 'Haapavesi', 'Hailuoto', 'Halsua', 'Hamina', 'Hammarland', 'Hankasalmi', 'Hanko', 'Harjavalta', 'Hartola', 'Hattula', 'Hausjärvi', 'Heinola', 'Heinävesi', 'Helsinki', 'Hirvensalmi', 'Hollola', 'Huittinen', 'Humppila', 'Hyrynsalmi', 'Hyvinkää', 'Hämeenkyrö', 'Hämeenlinna', 'Ii', 'Iisalmi', 'Iitti', 'Ikaalinen', 'Ilmajoki', 'Ilomantsi', 'Imatra', 'Inari', 'Inkoo', 'Isojoki', 'Isokyrö', 'Janakkala', 'Joensuu', 'Jokioinen', 'Jomala', 'Joroinen', 'Joutsa', 'Juuka', 'Juupajoki', 'Juva', 'Jyväskylä', 'Jämijärvi', 'Jämsä', 'Järvenpää', 'Kaarina', 'Kaavi', 'Kajaani', 'Kalajoki', 'Kangasala', 'Kangasniemi', 'Kankaanpää', 'Kannonkoski', 'Kannus', 'Karijoki', 'Karkkila', 'Karstula', 'Karvia', 'Kaskinen', 'Kauhajoki', 'Kauhava', 'Kauniainen', 'Kaustinen', 'Keitele', 'Kemi', 'Kemijärvi', 'Keminmaa', 'Kemiönsaari', 'Kempele', 'Kerava', 'Keuruu', 'Kihniö', 'Kinnula', 'Kirkkonummi', 'Kitee', 'Kittilä', 'Kiuruvesi', 'Kivijärvi', 'Kokemäki', 'Kokkola', 'Kolari', 'Konnevesi', 'Kontiolahti', 'Korsnäs', 'Koski Tl', 'Kotka', 'Kouvola', 'Kristiinankaupunki', 'Kruunupyy', 'Kuhmo', 'Kuhmoinen', 'Kumlinge', 'Kuopio', 'Kuortane', 'Kurikka', 'Kustavi', 'Kuusamo', 'Kyyjärvi', 'Kärkölä', 'Kärsämäki', 'Kökar', 'Lahti', 'Laihia', 'Laitila', 'Lapinjärvi', 'Lapinlahti', 'Lappajärvi', 'Lappeenranta', 'Lapua', 'Laukaa', 'Lemi', 'Lemland', 'Lempäälä', 'Leppävirta', 'Lestijärvi', 'Lieksa', 'Lieto', 'Liminka', 'Liperi', 'Lohja', 'Loimaa', 'Loppi', 'Loviisa', 'Luhanka', 'Lumijoki', 'Lumparland', 'Luoto', 'Luumäki', 'Maalahti', 'Maarianhamina – Mariehamn', 'Marttila', 'Masku', 'Merijärvi', 'Merikarvia', 'Miehikkälä', 'Mikkeli', 'Muhos', 'Multia', 'Muonio', 'Mustasaari', 'Muurame', 'Mynämäki', 'Myrskylä', 'Mäntsälä', 'Mänttä-Vilppula', 'Mäntyharju', 'Naantali', 'Nakkila', 'Nivala', 'Nokia', 'Nousiainen', 'Nurmes', 'Nurmijärvi', 'Närpiö', 'Orimattila', 'Oripää', 'Orivesi', 'Oulainen', 'Oulu', 'Outokumpu', 'Padasjoki', 'Paimio', 'Paltamo', 'Parainen', 'Parikkala', 'Parkano', 'Pedersöre', 'Pelkosenniemi', 'Pello', 'Perho', 'Pertunmaa', 'Petäjävesi', 'Pieksämäki', 'Pielavesi', 'Pietarsaari', 'Pihtipudas', 'Pirkkala', 'Polvijärvi', 'Pomarkku', 'Pori', 'Pornainen', 'Porvoo', 'Posio', 'Pudasjärvi', 'Pukkila', 'Punkalaidun', 'Puolanka', 'Puumala', 'Pyhtää', 'Pyhäjoki', 'Pyhäjärvi', 'Pyhäntä', 'Pyhäranta', 'Pälkäne', 'Pöytyä', 'Raahe', 'Raasepori', 'Raisio', 'Rantasalmi', 'Ranua', 'Rauma', 'Rautalampi', 'Rautavaara', 'Rautjärvi', 'Reisjärvi', 'Riihimäki', 'Ristijärvi', 'Rovaniemi', 'Ruokolahti', 'Ruovesi', 'Rusko', 'Rääkkylä', 'Saarijärvi', 'Salla', 'Salo', 'Saltvik', 'Sastamala', 'Sauvo', 'Savitaipale', 'Savonlinna', 'Savukoski', 'Seinäjoki', 'Sievi', 'Siikainen', 'Siikajoki', 'Siikalatva', 'Siilinjärvi', 'Simo', 'Sipoo', 'Siuntio', 'Sodankylä', 'Soini', 'Somero', 'Sonkajärvi', 'Sotkamo', 'Sottunga', 'Sulkava', 'Sund', 'Suomussalmi', 'Suonenjoki', 'Sysmä', 'Säkylä', 'Taipalsaari', 'Taivalkoski', 'Taivassalo', 'Tammela', 'Tampere', 'Tervo', 'Tervola', 'Teuva', 'Tohmajärvi', 'Toholampi', 'Toivakka', 'Tornio', 'Turku', 'Tuusniemi', 'Tuusula', 'Tyrnävä', 'Ulvila', 'Urjala', 'Utajärvi', 'Utsjoki', 'Uurainen', 'Uusikaarlepyy', 'Uusikaupunki', 'Vaala', 'Vaasa', 'Valkeakoski', 'Vantaa', 'Varkaus', 'Vehmaa', 'Vesanto', 'Vesilahti', 'Veteli', 'Vieremä', 'Vihti', 'Viitasaari', 'Vimpeli', 'Virolahti', 'Virrat', 'Vårdö', 'Vöyri', 'Ylitornio', 'Ylivieska', 'Ylöjärvi', 'Ypäjä', 'Ähtäri', 'Äänekoski'] %}
                    <a href="#" onclick="selectCity('{{ city }}'); return false;">{{ city }}</a>
                    {% endfor %}
                </div>
            </div>
            <input type="hidden" id="selected-city" name="city" value="{{ demo.city }}" required>
        </div>

        <div class="form-group">
            <label for="address">Osoite</label>
            <input type="text" id="address" name="address" class="form-control" value="{{ demo.address }}" required>
        </div>

        <div class="form-group">
            <label for="type">Tyyppi</label>
            <select id="type" name="type" class="form-control" required>
                <option value="marssi" {% if demo.event_type=='marssi' %}selected{% endif %}>Marssi</option>
                <option value="paikallaan" {% if demo.event_type=='paikallaan' %}selected{% endif %}>Paikallaan</option>
                <option value="muut" {% if demo.event_type=='muut' %}selected{% endif %}>Muut</option>
            </select>
        </div>

        <div id="march-route-container" class="form-group" {% if demo.event_type !='marssi' %}style="display:none;" {%
            endif %}>
            <label for="route">Reitti (marssin)</label>
            <input type="text" id="route" name="route" class="form-control" value="{{ demo.route }}">
        </div>

        <h4>Järjestäjätahojen tiedot</h4>

        <!-- Container for organizers -->
        <div id="organizers-container" class="container-columns">
            {% for organizer in demo.organizers %}
            <div class="form-group organizer-item">
                <hr>
                <label for="organizer_name_{{ loop.index }}">Järjestäjätahon nimi</label>
                <input type="text" id="organizer_name_{{ loop.index }}" name="organizer_name_{{ loop.index }}"
                    class="form-control" value="{{ organizer.name }}" required>
                <br><br>
                <label for="organizer_website_{{ loop.index }}">Nettisivu</label>
                <input type="url" id="organizer_website_{{ loop.index }}" name="organizer_website_{{ loop.index }}"
                    class="form-control" value="{{ organizer.website }}">
                <br><br>
                <label for="organizer_email_{{ loop.index }}">Sähköposti</label>
                <input type="email" id="organizer_email_{{ loop.index }}" name="organizer_email_{{ loop.index }}"
                    class="form-control" value="{{ organizer.email }}" required>
                <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeOrganizer(this)">Poista</button>
            </div>
            {% endfor %}
        </div>

        <button type="button" class="btn btn-primary mt-2" onclick="addOrganizer()">Lisää järjestäjä</button>

        <!-- Approved checkbox -->
        <div class="approval-wrapper mt-4">
            <div class="form-group" id="approval-container">
                <label for="approved">Hyväksytty</label>
                <div>
                    <input type="checkbox" id="approved" name="approved" class="form-check-input" {% if demo.approved
                        %}checked{% endif %}>
                    <span id="approval-status" class="status-text">
                        {% if demo.approved %}Kyllä{% else %}Ei{% endif %}
                    </span>
                </div>
            </div>
        </div>

        <button type="submit" class="submit-button mt-3">Tallenna</button>
    </form>
</div>

<script>
    let organizerCount = {{ demo.organizers | length }};

    function addOrganizer() {
        organizerCount++;
        const container = document.getElementById('organizers-container');
        const organizerDiv = document.createElement('div');
        organizerDiv.className = 'form-group organizer-item';

        organizerDiv.innerHTML = `
            <hr>
            <label for="organizer_name_${organizerCount}">Järjestäjätahon nimi</label>
            <input type="text" id="organizer_name_${organizerCount}" name="organizer_name_${organizerCount}" class="form-control" placeholder="Järjestäjän nimi" required>
            <label for="organizer_website_${organizerCount}">Nettisivu</label>
            <input type="url" id="organizer_website_${organizerCount}" name="organizer_website_${organizerCount}" class="form-control" placeholder="https://example.com">
            <label for="organizer_email_${organizerCount}">Sähköposti</label>
            <input type="email" id="organizer_email_${organizerCount}" name="organizer_email_${organizerCount}" class="form-control" placeholder="sähköposti@example.com">
            <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeOrganizer(this)">Poista</button>
        `;

        container.appendChild(organizerDiv);
    }

    function removeOrganizer(button) {
        const container = document.getElementById('organizers-container');
        container.removeChild(button.parentElement);
    }

    document.getElementById('type').addEventListener('change', function () {
        const marchRouteContainer = document.getElementById('march-route-container');
        if (this.value === 'marssi') {
            marchRouteContainer.style.display = 'block';
        } else {
            marchRouteContainer.style.display = 'none';
        }
    });

    // Paikkakunta dropdown functions
    function selectCity(city) {
        document.querySelector('.dropbtn').textContent = city;
        document.getElementById('selected-city').value = city;
        document.getElementById('dropdown-content').style.display = 'none';
    }

    function filterFunction() {
        let input, filter, div, a, i;
        input = document.getElementById('searchInput');
        if (input !== '') {
            filter = input.value.toUpperCase();
            div = document.getElementById('dropdown-content');
            a = div.getElementsByTagName('a');
            for (i = 0; i < a.length; i++) {
                let txtValue = a[i].textContent || a[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    a[i].style.display = '';
                } else {
                    a[i].style.display = 'none';
                }
            }
        }
    }

    document.querySelector('.dropbtn').addEventListener('click', function () {
        document.getElementById('dropdown-content').style.display = 'block';
    });

    window.onclick = function (event) {
        console.log(event.target);
        if (!event.target.matches('.dropdown')) {
            if (event.target !== document.getElementByClassName("dropdown-content")) {
                var dropdowns = document.getElementsByClassName('dropdown-content');
                for (let i = 0; i < dropdowns.length; i++) {
                    let openDropdown = dropdowns[i];
                    if (openDropdown.style.display === 'block') {
                        openDropdown.style.display = 'none';
                    }
                }
            }
        }
    };
</script>
{% endblock %}