{% extends 'admin_base.html' %}

{% block main_content %}
<!-- Include CSS and JS files -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/demo_form.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/demo_checkbox.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/recu_dash.css') }}">

<script src="{{ url_for('static', filename='js/admin_demo_checkbox.js') }}"></script>
<!-- Include Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- Include Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Main content container -->
<div class="container container-form">
    <h2 class="form-title">{{ title }}</h2>
    <form method="POST" action="{{ form_action }}">

        <!-- Form fields with required indicators -->
        <div class="form-group">
            <label for="title">Otsikko <span class="required">*</span></label>
            <input type="text" id="title" name="title" class="form-control" value="{{ demo.title if demo and demo.title else '' }}" required>
        </div>
        <div class="form-group">
            <label for="date">Päivämäärä (pp.kk.vvvv) <span class="required">*</span></label>
            <input type="text" id="date" name="date" class="form-control" value="{{ demo.date if demo and demo.date else '' }}" required>
        </div>
        
        <div class="form-group">
            <label for="start_time">Alkamisaika <span class="required">*</span></label>
            <input type="text" id="start_time" name="start_time" class="form-control" value="{{ demo.start_time if demo and demo.start_time else '' }}" required>
        </div>
        <div class="form-group">
            <label for="end_time">Päättymisaika</label>
            <input type="text" id="end_time" name="end_time" class="form-control" value="{{ demo.end_time if demo and demo.end_time else '' }}">
        </div>
        
        <div class="form-group">
            <label for="topic">Aihe <span class="required">*</span></label>
            <input type="text" id="topic" name="topic" class="form-control" value="{{ demo.topic if demo and demo.topic else '' }}" required>
        </div>
        <div class="form-group">
            <label for="facebook">Facebook linkki</label>
            <input type="url" id="facebook" name="facebook" class="form-control" value="{{ demo.facebook if demo and demo.facebook else '' }}">
        </div>

        <!-- City Selector with dropdown -->
        <div class="form-group">
            <label for="city">Paikkakunta <span class="required">*</span></label>
            <div class="dropdown">
                <button type="button" class="dropbtn">{{ demo.city if demo and demo.city else 'Valitse paikkakunta' }}</button>
                <div id="dropdown-content" class="dropdown-content">
                    <input type="text" placeholder="Hae paikkakunta..." id="searchInput" onkeyup="filterFunction()">
                    {% for city in city_list %}
                    <a href="#" onclick="selectCity('{{ city }}'); return false;">{{ city }}</a>
                    {% endfor %}
                </div>
            </div>
            <input type="hidden" id="selected-city" name="city" value="{{ demo.city if demo and demo.city else '' }}" required>
        </div>

        <!-- Address Field -->
        <div class="form-group">
            <label for="address">Osoite <span class="required">*</span></label>
            <input type="text" id="address" name="address" class="form-control" value="{{ demo.address if demo and demo.address else '' }}" required>
        </div>

        <!-- Event Type Selector -->
        <div class="form-group">
            <label for="type">Tyyppi <span class="required">*</span></label>
            <select id="type" name="type" class="form-control" required>
                <option value="marssi" {% if demo and demo.event_type == 'marssi' %}selected{% endif %}>Marssi</option>
                <option value="paikallaan" {% if demo and demo.event_type == 'paikallaan' %}selected{% endif %}>Paikallaan</option>
                <option value="muut" {% if demo and demo.event_type == 'muut' %}selected{% endif %}>Muut</option>
            </select>
        </div>

        <!-- March Route Input -->
        <div id="march-route-container" class="form-group" {% if demo and demo.event_type != 'marssi' %}style="display:none;"{% endif %}>
            <label for="route">Reitti (marssin)</label>
            <input type="text" id="route" name="route" class="form-control" value="{{ demo.route if demo and demo.route else '' }}">
        </div>

        <h4>Järjestäjätahojen tiedot</h4>

        <!-- Organizers Section -->
        <div id="organizers-container" class="container-columns">
            {% if demo and demo.organizers %}
                {% for organizer in demo.organizers %}
                <div class="form-group organizer-item">
                    <hr>
                    <label for="organizer_name_{{ loop.index }}">Järjestäjätahon nimi <span class="required">*</span></label>
                    <input type="text" id="organizer_name_{{ loop.index }}" name="organizer_name_{{ loop.index }}" class="form-control" value="{{ organizer.name }}" required>
                    <label for="organizer_website_{{ loop.index }}">Nettisivu</label>
                    <input type="url" id="organizer_website_{{ loop.index }}" name="organizer_website_{{ loop.index }}" class="form-control" value="{{ organizer.website }}">
                    <label for="organizer_email_{{ loop.index }}">Sähköposti</label>
                    <input type="email" id="organizer_email_{{ loop.index }}" name="organizer_email_{{ loop.index }}" class="form-control" value="{{ organizer.email }}">
                    <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeOrganizer(this)">Poista</button>
                </div>
                {% endfor %}
            {% endif %}
        </div>

        <button type="button" class="btn btn-primary mt-2" onclick="addOrganizer()">Lisää järjestäjä</button>

        <!-- Approval Checkbox -->
        <div class="approval-wrapper mt-4">
            <div class="form-group" id="approval-container">
                <label for="approved">Hyväksytty</label>
                <div>
                    <input type="checkbox" id="approved" name="approved" class="form-check-input" {% if demo and demo.approved %}checked{% endif %}>
                    <span id="approval-status" class="status-text">{% if demo and demo.approved %}Kyllä{% else %}Ei{% endif %}</span>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="btn btn-submit mt-3">{{ submit_button_text }}</button>
        </div>
    </form>
</div>

<script>
    // City Selector JS functions
    function selectCity(city) {
        document.querySelector('.dropbtn').textContent = city;
        document.getElementById('selected-city').value = city;
        document.getElementById('dropdown-content').style.display = 'none';
    }

    function filterFunction() {
        let input, filter, div, a;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase();
        div = document.getElementById('dropdown-content');
        a = div.getElementsByTagName('a');
        for (let i = 0; i < a.length; i++) {
            let txtValue = a[i].textContent || a[i].innerText;
            a[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
        }
    }

    // Organizer JS functions
    let organizerCount = {{ demo.organizers | length if demo and demo.organizers else 0 }};

    function addOrganizer() {
        organizerCount++;
        const container = document.getElementById('organizers-container');
        const organizerDiv = document.createElement('div');
        organizerDiv.className = 'form-group organizer-item';

        organizerDiv.innerHTML = `
            <hr>
            <label for="organizer_name_${organizerCount}">Järjestäjätahon nimi <span class="required">*</span></label>
            <input type="text" id="organizer_name_${organizerCount}" name="organizer_name_${organizerCount}" class="form-control" placeholder="Järjestäjän nimi" required>
            <label for="organizer_website_${organizerCount}">Nettisivu</label>
            <input type="url" id="organizer_website_${organizerCount}" name="organizer_website_${organizerCount}" class="form-control" placeholder="Nettisivun URL">
            <label for="organizer_email_${organizerCount}">Sähköposti</label>
            <input type="email" id="organizer_email_${organizerCount}" name="organizer_email_${organizerCount}" class="form-control" placeholder="Sähköpostiosoite">
            <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeOrganizer(this)">Poista</button>
        `;
        container.appendChild(organizerDiv);
    }

    function removeOrganizer(button) {
        button.parentElement.remove();
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        flatpickr("#date", {
            dateFormat: "d.m.Y", // Date format
            altInput: true,
            altFormat: "d.m.Y",
            allowInput: true,
        });

        flatpickr("#start_time", {
            enableTime: true, // Enable time selection
            noCalendar: true, // Disable calendar
            dateFormat: "H:i", // 24-hour format
            altInput: true,
            altFormat: "H:i", // Alternate input format for display
            allowInput: true,
            time_24hr: true, // Ensure 24-hour format
        });

        flatpickr("#end_time", {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            altInput: true,
            altFormat: "H:i",
            allowInput: true,
            time_24hr: true, // Ensure 24-hour format
        });
    });
</script>


{% endblock %}
