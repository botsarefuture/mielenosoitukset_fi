{% extends 'base.html' %} {% block title %} {{ demo['title'] }} {% endblock %}
{% block meta %}
<meta name="description" content="{{ demo['title'] }} - Mielenosoitukset.fissä" />
<meta name="description" content="{{ demo['title'] }} - Mielenosoitukset.fissä" />
<meta property="og:title" content="{{ demo['title'] }}" />
<meta property="og:description" content="{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}" />
<meta property="og:description" content="{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}" />
<meta property="og:image" content="{{ demo['img'] }}" />
<meta property="og:url" content="{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}" />
<meta property="og:url" content="{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}" />
<meta property="og:type" content="event" />
<meta property="og:site_name" content="Mielenosoitukset.fi" />

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "{{ demo['title'] }}",
  "startDate": "{{ demo['date'] }}T{{ demo['start_time'] }}",
  "endDate": "{{ demo['date'] }}T{{ demo['end_time'] }}",
  "location": {
    "@type": "Place",
    "name": "{{ demo['topic'] }}",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "{{ demo['address'] }}",
      "addressLocality": "{{ demo['city'] }}",
      "addressRegion": "FI",
      "postalCode": "{{ demo['postal_code'] }}", // Add postal code if available
      "addressCountry": "FI"
    }
  },
  "description": "{{ demo['description'] if demo['description'] else 'Mielenosoituksen tiedot.' }}",
  "image": "{{ demo['img'] }}",
  "url": "{{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}",
  "organizer": {
    "@type": "Organization",
    "name": "{{ demo['organizers'][0].name if demo['organizers'] else 'Tuntematon' }}",
    "url": "{{ url_for('org', org_id=demo['organizers'][0].organization_id) if demo['organizers'] else '#' }}"
  }
}
</script>
{% endblock %}
 {% block content %}

<style>
  /* Main Container */
  #main {
    background-color: #f4f4f4;
    padding: 20px;
    margin: 0 auto;
    max-width: 800px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  /* Headings */
  h1 {
    color: #0033a0;
    margin-bottom: 20px;
    border-bottom: 2px solid #0033a0;
    padding-bottom: 10px;
    font-family: "Montserrat", sans-serif;
    overflow-wrap: break-word;
  }

  /* Images */
  #main img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 20px;
  }

  /* Flex Containers */
  #subcontainer1 {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }

  /* Info and Organizer Containers */
  #infocontainer,
  #orginfo {
    flex: 1;
    min-width: 300px;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
  }

  #infocontainer {
    border-right: 4px dotted #0033a0;
  }

  /* Subtitle */
  .subtitle {
    margin-top: 0;
    font-size: 1.2em;
    color: #0033a0;
    text-align: center;
  }

  /* Media Queries */
  @media only screen and (max-width: 767px) {
    #infocontainer {
      border-right: none;
      border-bottom: 4px dotted #0033a0;
    }

    #subcontainer1 {
      flex-direction: column;
    }
  }

  /* Social Buttons */
  .social-button {
    display: inline-block;
    margin-top: 10px;
    padding: 10px 20px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    text-decoration: none;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  .like-button {
    background-color: #4267b2;
    color: #ffffff;
  }

  .like-button:hover {
    background-color: #365899;
  }

  /* Organizer Info */
  .organizer-info {
    background-color: #f0f8ff; /* Light background for contrast */
    border: 1px solid #0033a0; /* Border to distinguish each organizer */
    border-radius: 8px;
    padding: 15px; /* Add padding for better spacing */
    margin-bottom: 20px;
    transition: transform 0.2s; /* Smooth scaling effect on hover */
  }

  .organizer-info:hover {
    transform: scale(1.02); /* Slightly enlarge on hover */
  }

  .organizer-info a {
    color: #0033a0;
    text-decoration: none;
    font-weight: bold;
  }

  .organizer-info a:hover {
    text-decoration: underline;
    color: #ff6600;
  }

  /* Back Link */
  .back-link {
    display: inline-block;
    margin-top: 20px;
    padding: 10px 20px;
    background-color: #0033a0;
    color: #ffffff;
    border-radius: 4px;
    text-decoration: none;
    transition: background-color 0.3s ease;
    text-align: center;
  }

  .back-link:hover {
    background-color: #0066cc;
  }

  /* Strong Elements */
  strong {
    color: #0033a0;
  }

  /* Route Information */
  .route {
    margin-top: 20px;
    padding: 15px;
    background-color: #ffffff;
    border-left: 5px solid #0033a0;
    border-radius: 8px;
  }

  /* General Links */
  a {
    color: #0033a0;
    text-decoration: none;
    font-weight: bold;
  }

  a:hover {
    text-decoration: underline;
    color: #ff6600;
  }

  /* Countdown */
  .countdown {
    margin-top: 20px;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  /* Map Container */
  .map {
    margin-top: 20px;
    background-color: #ffffff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  /* Organizers List */
  .organizers-list {
    display: flex;
    flex-direction: column;
    gap: 15px; /* Add spacing between organizers */
  }

  .button-container {
    display: flex;
    flex-direction: row;
    justify-content: space-between; /* Evenly spaces buttons */
    padding: 20px; /* Optional: adds some padding around the container */
    gap: 5px;
  }

  @media (max-width: 620px) {
    .button-container {
      flex-direction: column;
    }

    h1 {
      text-align: center;
    }

  }

  .button {
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
</style>

<div id="main">
  {% if demo['img'] %}
  <img src="{{ demo['img'] }}" alt="Event Image" />
  {% else %}
  <!--
  <img
    src="https://mielenosoitukset-fi1.fsn1.your-objectstorage.com/demos/default.jpg"
  />-->

  {% endif %}
  <h1>{{ demo['title'] }}</h1>
  <div>
    <!--<a href="#" class="like-button"> Tykkää </a>-->
    <!-- Social Media Share Buttons -->
    <div class="button-container">
      <a
        href="https://www.facebook.com/sharer/sharer.php?u={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}"
        target="_blank"
        class="facebook-button button"
      >
        Jaa Facebookissa
      </a>
      <a
        href="https://twitter.com/intent/tweet?url={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}&text={{ demo['title'] }}"
        target="_blank"
        class="twitter-button button"
      >
        Jaa Xssä
      </a>
      <a
        href="https://www.linkedin.com/shareArticle?mini=true&url={{ url_for('demonstration_detail', demo_id=demo['_id'], _external=True) }}&title={{ demo['title'] }}"
        target="_blank"
        class="linkedin-button button"
      >
        Jaa LinkedInissä
      </a>
    </div>
  </div>

  {% if demo['description'] %}
  <div class="container" style="margin-top: 20px;
	padding: 20px;
	background-color: #ffffff;
	border-radius: 8px;
	text-align: center;
	box-shadow: 0 0 10px var(--error-color);">
  <h2 class="subtitle">Esittely</h2>
  {{ demo['description']|safe }}
</div>
{% endif %}
  <div class="countdown">
    <h2 class="subtitle">Aikaa mielenosoituksen alkuun</h2>
    <div id="timer" style="font-size: 24px; color: #0033a0"></div>
  </div>
  <br />
  <div class="map">
    <div id="map" style="height: 300px"></div>
  </div>
  <br />

  <div id="subcontainer1">
    <div id="infocontainer">
      <h2 class="subtitle">Lisätiedot</h2>
      <p><strong>Päivämäärä:</strong><br />{{ demo['date'] }}</p>
      <p><strong>Alkamisaika:</strong><br />{{ demo['start_time'] }}</p>
      <p><strong>Päättymisaika:</strong><br />{{ demo['end_time'] }}</p>
      <p><strong>Aihe:</strong><br />{{ demo['topic'] }}</p>
      <p>
        <strong>Sijainti:</strong><br />{{ demo['address'] }}, {{ demo['city']
        }}
      </p>

      {% if demo['route'] and demo['route'] != "None" %}
      <div class="route">
        <p><strong>Marssin reitti:</strong></p>
        <p>{{ demo['route'] }}</p>
      </div>
      {% endif %} {% if demo['facebook'] %}
      <a href="{{ demo['facebook'] }}" target="_blank" class="facebook-button">
        Facebook-tapahtuma
      </a>
      {% endif %}
    </div>

    <div id="orginfo">
      <h2 class="subtitle">Järjestäjät</h2>
      {% if demo['organizers'] %}
      <div class="organizers-list">
        {% for org in demo['organizers'] %}
        <div class="organizer-info">
          <p><strong>Nimi:</strong><br />{{ org.name }}</p>

          {% if org['organization_id'] %}
          <p>
            <a
              href="{{ url_for('org', org_id=org.organization_id) }}"
              class="org-profile-link"
              >Mielenosoitukset.fi -profiili</a
            >
          </p>
          {% endif %} {% if org['website'] %}
          <p>
            <strong>Nettisivu:</strong><br />
            <a href="{{ org['website'] }}" target="_blank" class="org-website"
              >{{ org['website'] }}</a
            >
          </p>
          {% endif %} {% if org['email'] %}
          <p>
            <strong>Sähköposti:</strong><br />
            <a href="mailto:{{ org['email'] }}" class="org-email"
              >{{ org['email'] }}</a
            >
          </p>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p>Ei järjestäjätietoja saatavilla.</p>
      {% endif %}
    </div>

    <a class="back-link" href="{{ url_for('demonstrations') }}"
      >Takaisin kaikkiin mielenosoituksiin</a
    >
  </div>

  <!-- Leaflet JS and Map Integration -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script>
    {% if latitude is not none %}
      var map = L.map("map").setView([{{ latitude }}, {{ longitude }}], 13);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      L.marker([{{ latitude }}, {{ longitude }}])
        .addTo(map)
        .bindPopup("{{ demo['address'] | escape }}")
        .openPopup();
    {% else %}
      var mapElement = document.getElementById("map");
      if (mapElement) {
        mapElement.remove();  // Removes the map element if it exists
      }
    {% endif %}
  </script>
  <script>
    function formatFinnishDate(dateString) {
      // Convert Finnish date format (pp.kk.vvvv) to ISO format (yyyy-mm-dd)
      const [day, month, year] = dateString.split(".").map(Number);
      return `${year}-${month.toString().padStart(2, "0")}-${day
        .toString()
        .padStart(2, "0")}`;
    }

    function updateCountdown() {
      // Replace these with your actual Finnish date and time strings for testing
      const demoDate = "{{ demo['date'] }}"; // e.g., "09.09.2024"
      const demoTime = "{{ demo['start_time'] }}"; // e.g., "14:00:00"

      const formattedDate = formatFinnishDate(demoDate);
      const eventDateStr = `${formattedDate}T${demoTime}`;
      console.log(`Event Date String: ${eventDateStr}`);

      const eventDate = new Date(eventDateStr);
      const now = new Date();
      const timeRemaining = eventDate - now;

      console.log(`Current Time: ${now}`);
      console.log(`Event Time: ${eventDate}`);
      console.log(`Time Remaining: ${timeRemaining}`);

      if (timeRemaining <= 0) {
        document.getElementById("timer").innerText =
          "Mielenosoitus on käynnissä!";
        return;
      }

      const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
      const hours = Math.floor(
        (timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
      );
      const minutes = Math.floor(
        (timeRemaining % (1000 * 60 * 60)) / (1000 * 60)
      );
      const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

      document.getElementById(
        "timer"
      ).innerText = `${days} päivää ${hours} tuntia ${minutes} minuuttia ${seconds} sekuntia`;
    }

    setInterval(updateCountdown, 1000);
  </script>
  {% endblock %}
</div>
