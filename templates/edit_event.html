{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/edit.css') }}">
<div class="form-container">
    <h2>Muokkaa mielenosoitusta</h2>

    <form method="POST" action="{{ url_for('edit_event', demo_id=demo._id) }}">
        <!-- Comment: Form for editing event details -->
        <!-- TODO: Add client-side validation to improve user experience -->

        <!-- Name -->
        <label for="title">Mielenosoituksen nimi</label>
        <input type="text" id="title" name="title" value="{{ demo.title }}" placeholder="Mielenosoituksen nimi" required>
        <!-- Comment: Input field for the event's title -->

        <!-- Tag (Aihe) -->
        <label for="topic">Aihe</label>
        <input type="text" id="topic" name="topic" value="{{ demo.topic }}" placeholder="Aihe" required>
        <!-- Comment: Input field for the event's topic -->

        <!-- Date -->
        <label for="date">Päivämäärä (pp.kk.vvvv)</label>
        <input type="text" id="date" name="date" value="{{ demo.date }}" placeholder="pp.kk.vvvv" required>
        <!-- Comment: Input field for the event's date in the format day.month.year -->

        <!-- Start and End Time -->
        <label for="start_time">Alkamisaika</label>
        <input type="time" id="start_time" name="start_time" value="{{ demo.start_time }}" required>
        <!-- Comment: Input field for the event's start time -->

        <label for="end_time">Päättymisaika</label>
        <input type="time" id="end_time" name="end_time" value="{{ demo.end_time }}" required>
        <!-- Comment: Input field for the event's end time -->

        <!-- Additional Information -->
        <label for="facebook">Facebook-tapahtumalinkki (valinnainen)</label>
        <input type="url" id="facebook" name="facebook" value="{{ demo.facebook }}" placeholder="https://facebook.com/event">
        <!-- Comment: Input field for an optional Facebook event link -->

        <!-- Organizers -->
        <label for="organizers">Järjestäjä(t)</label>
        <div id="organizers-container">
            <!-- Comment: Container for dynamically added organizers -->
            {% for organizer in demo.organizers %}
                <div class="organizer">
                    <hr>
                    <label for="organizer_name_{{ loop.index }}">Nimi</label>
                    <input type="text" id="organizer_name_{{ loop.index }}" name="organizers[]" value="{{ organizer.name }}" placeholder="Järjestäjän nimi" required>

                    <label for="organizer_website_{{ loop.index }}">Nettisivu</label>
                    <input type="url" id="organizer_website_{{ loop.index }}" name="organizer_websites[]" value="{{ organizer.website }}" placeholder="https://example.com">

                    <label for="organizer_email_{{ loop.index }}">Sähköposti</label>
                    <input type="email" id="organizer_email_{{ loop.index }}" name="organizer_emails[]" value="{{ organizer.email }}" placeholder="sähköposti@example.com" required>
                    <button type="button" class="remove-organizer" onclick="removeOrganizer(this)">Poista</button>
                </div>
            {% endfor %}
        </div>
        <button type="button" id="add-organizer-button">Lisää järjestäjä</button>
        <!-- Comment: Button to add more organizers dynamically -->

        <!-- Location -->
        <label for="type">Tyyppi</label>
        <select id="type" name="type" required>
            <option value="marssi" {% if demo.event_type == 'marssi' %}selected{% endif %}>Marssi</option>
            <option value="paikallaan" {% if demo.event_type == 'paikallaan' %}selected{% endif %}>Paikallaan</option>
            <option value="muut" {% if demo.event_type == 'muut' %}selected{% endif %}>Muut</option>
        </select>
        <!-- Comment: Dropdown for selecting event type -->

        <div id="march-route-container" class="optional-section" style="{% if demo.event_type == 'marssi' %}display: block;{% else %}display: none;{% endif %}">
            <label for="route">Reitti (vain marssille, valinnainen)</label>
            <textarea id="route" name="route" placeholder="Reitti...">{{ demo.route }}</textarea>
        </div>
        <!-- Comment: Textarea for the march route, visible only if the event type is 'marssi' -->

        <label for="city">Kaupunki</label>
        <input type="text" id="city" name="city" value="{{ demo.city }}" placeholder="Kaupunki" required>
        <!-- Comment: Input field for the city of the event -->

        <label for="address">Katuosoite</label>
        <input type="text" id="address" name="address" value="{{ demo.address }}" placeholder="Katuosoite" required>
        <!-- Comment: Input field for the street address of the event -->

        <button type="submit" class="submit-button">Päivitä</button>
        <!-- Comment: Submit button to update the event details -->
    </form>
</div>

<script>
    let organizerCount = {{ demo.organizers | length }};
    
    function addOrganizer() {
        organizerCount++;
        const container = document.getElementById('organizers-container');
        const organizerDiv = document.createElement('div');
        organizerDiv.className = 'organizer';

        organizerDiv.innerHTML = `
            <hr>
            <label for="organizer_name_${organizerCount}">Nimi</label>
            <input type="text" id="organizer_name_${organizerCount}" name="organizers[]" placeholder="Järjestäjän nimi" required>

            <label for="organizer_website_${organizerCount}">Nettisivu</label>
            <input type="url" id="organizer_website_${organizerCount}" name="organizer_websites[]" placeholder="https://example.com">

            <label for="organizer_email_${organizerCount}">Sähköposti</label>
            <input type="email" id="organizer_email_${organizerCount}" name="organizer_emails[]" placeholder="sähköposti@example.com" required>
            <button type="button" class="remove-organizer" onclick="removeOrganizer(this)">Poista</button>
        `;

        container.appendChild(organizerDiv);
    }

    function removeOrganizer(button) {
        button.parentElement.remove();
    }

    document.getElementById('add-organizer-button').addEventListener('click', addOrganizer);
    <!-- Comment: Event listener to add a new organizer when the button is clicked -->

    document.getElementById('type').addEventListener('change', function() {
        var marchRouteContainer = document.getElementById('march-route-container');
        if (this.value === 'marssi') {
            marchRouteContainer.style.display = 'block';
        } else {
            marchRouteContainer.style.display = 'none';
        }
    });

    window.addEventListener('load', function() {
        var typeSelect = document.getElementById('type');
        var marchRouteContainer = document.getElementById('march-route-container');
        marchRouteContainer.style.display = typeSelect.value === 'marssi' ? 'block' : 'none';
    });
    <!-- Comment: Initial display setting for the march route container based on selected event type -->
</script>
{% endblock %}
