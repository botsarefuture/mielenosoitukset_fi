{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit.css') }}">
<div class="form-container">
    <h2>Ilmoita mielenosoituksesta</h2>

    <form method="POST" action="{{ url_for('submit') }}">
        <!-- Name -->
        <label for="name">Mielenosoituksen nimi</label>
        <input type="text" id="name" name="title" placeholder="Mielenosoituksen nimi" required>
        <!-- Tag (Aihe) -->
        <label for="topic">Aihe</label>
        <input type="text" id="topic" name="topic" placeholder="Aihe" required>
        <!-- Date -->
        <label for="date">Päivämäärä (pp.kk.vvvv)</label>
        <input type="text" id="date" name="date" placeholder="pp.kk.vvvv" required>
        <!-- Start and End Time -->
        <label for="start_time">Alkamisaika</label>
        <input type="time" id="start_time" name="start_time" required>
        <label for="end_time">Päättymisaika</label>
        <input type="time" id="end_time" name="end_time" required>
        <!-- Additional Information -->
        <label for="facebook">Facebook-tapahtumalinkki (valinnainen)</label>
        <input type="url" id="facebook" name="facebook" placeholder="https://facebook.com/event">
        <!-- Organizers -->
        <label for="organizers">Järjestäjä(t)</label>
        <div id="organizers-container"></div>
        <button type="button" class="add-organizer-button" onclick="addOrganizer()">Lisää järjestäjä</button>
        <!-- Location -->
        <label for="type">Tyyppi</label>
        <select id="type" name="type" required>
            <option value="" disabled selected>Valitse mielenosoituksen tyyppi</option>
            <option value="marssi">Marssi</option>
            <option value="paikallaan">Paikallaan</option>
            <option value="muut">Muut</option>
        </select>
        <div id="march-route-container" class="optional-section">
            <label for="route">Reitti (vain marssille, valinnainen)</label>
            <textarea id="route" name="route" placeholder="Reitti..."></textarea>
        </div>

        <!-- City (Dropdown for Finnish Paikkakunnat) -->
        <label for="city">Paikkakunta</label>
        <div class="dropdown">
            <button type="button" class="dropbtn">Valitse paikkakunta</button>
            <div id="dropdown-content" class="dropdown-content">
                <input type="text" placeholder="Hae paikkakunta..." id="searchInput" onkeyup="filterFunction()">
                <a href="#" onclick="selectCity('Helsinki'); return false;">Helsinki</a>
                <a href="#" onclick="selectCity('Espoo'); return false;">Espoo</a>
                <a href="#" onclick="selectCity('Tampere'); return false;">Tampere</a>
                <a href="#" onclick="selectCity('Vantaa'); return false;">Vantaa</a>
                <a href="#" onclick="selectCity('Oulu'); return false;">Oulu</a>
                <a href="#" onclick="selectCity('Turku'); return false;">Turku</a>
                <a href="#" onclick="selectCity('Jyväskylä'); return false;">Jyväskylä</a>
                <a href="#" onclick="selectCity('Lahti'); return false;">Lahti</a>
                <a href="#" onclick="selectCity('Kuopio'); return false;">Kuopio</a>
                <a href="#" onclick="selectCity('Kouvola'); return false;">Kouvola</a>
                <a href="#" onclick="selectCity('Pori'); return false;">Pori</a>
                <a href="#" onclick="selectCity('Joensuu'); return false;">Joensuu</a>
                <a href="#" onclick="selectCity('Lappeenranta'); return false;">Lappeenranta</a>
                <a href="#" onclick="selectCity('Vaasa'); return false;">Vaasa</a>
                <a href="#" onclick="selectCity('Rovaniemi'); return false;">Rovaniemi</a>
                <a href="#" onclick="selectCity('Seinäjoki'); return false;">Seinäjoki</a>
                <a href="#" onclick="selectCity('Mikkeli'); return false;">Mikkeli</a>
                <a href="#" onclick="selectCity('Kotka'); return false;">Kotka</a>
                <a href="#" onclick="selectCity('Salo'); return false;">Salo</a>
                <a href="#" onclick="selectCity('Kokkola'); return false;">Kokkola</a>
                <a href="#" onclick="selectCity('Kajaani'); return false;">Kajaani</a>
                <a href="#" onclick="selectCity('Rauma'); return false;">Rauma</a>
            </div>
        </div>
        <input type="hidden" id="selected-city" name="city" required>


        <label for="address">Katuosoite</label>
        <input type="text" id="address" name="address" placeholder="Katuosoite" required>

        <button type="submit" class="submit-button">Lähetä</button>
    </form>
</div>

<script>
    let organizerCount = 0;

    function addOrganizer() {
        organizerCount++;
        const container = document.getElementById('organizers-container');
        const organizerDiv = document.createElement('div');
        organizerDiv.className = 'organizer';

        organizerDiv.innerHTML = `
            <div class="organizer-entry">
                <hr>
                <label for="organizer_name_${organizerCount}">Nimi</label>
                <input type="text" id="organizer_name_${organizerCount}" name="organizer_name_${organizerCount}" placeholder="Järjestäjän nimi" required>

                <label for="organizer_website_${organizerCount}">Nettisivu</label>
                <input type="url" id="organizer_website_${organizerCount}" name="organizer_website_${organizerCount}" placeholder="https://example.com">

                <label for="organizer_email_${organizerCount}">Sähköposti</label>
                <input type="email" id="organizer_email_${organizerCount}" name="organizer_email_${organizerCount}" placeholder="sähköposti@example.com" required>
            </div>
        `;

        container.appendChild(organizerDiv);
    }

    document.getElementById('type').addEventListener('change', function () {
        var marchRouteContainer = document.getElementById('march-route-container');
        if (this.value === 'marssi') {
            marchRouteContainer.style.display = 'block';
        } else {
            marchRouteContainer.style.display = 'none';
        }
    });

    function filterFunction() {
        let input, filter, div, a, i;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        div = document.getElementById("dropdown-content");
        a = div.getElementsByTagName("a");
        for (i = 0; i < a.length; i++) {
            let txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
            } else {
                a[i].style.display = "none";
            }
        }
    }

    // Show or hide the dropdown content
    document.querySelector('.dropbtn').addEventListener('click', function () {
        const dropdownContent = document.getElementById('dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    });

    // Filter function for the search input in the dropdown
    function filterFunction() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toUpperCase();
        const div = document.getElementById("dropdown-content");
        const a = div.getElementsByTagName("a");
        for (let i = 0; i < a.length; i++) {
            const txtValue = a[i].textContent || a[i].innerText;
            a[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
        }
    }

    // Set the selected city and hide the dropdown
    function selectCity(city) {
        document.getElementById('selected-city').value = city;
        document.querySelector('.dropbtn').innerText = city;
        document.getElementById('dropdown-content').style.display = 'none';
    }

    // Hide the dropdown if clicked outside
    window.onclick = function (event) {
        if (!event.target.matches('.dropbtn')) {
            const dropdownContent = document.getElementById('dropdown-content');
            if (dropdownContent.style.display === 'block') {
                dropdownContent.style.display = 'none';
            }
        }
    }

</script>
{% endblock %}