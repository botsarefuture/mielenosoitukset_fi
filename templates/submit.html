{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit.css') }}">
<div class="container container-main-content">
    <h2>Ilmoita mielenosoituksesta</h2>

    <form method="POST" action="{{ url_for('submit') }}" class="container-form">
        <!-- Name -->
        <label for="name" class="required">Mielenosoituksen nimi<span class="required-asterisk">*</span></label>
        <input type="text" id="name" name="title" placeholder="Mielenosoituksen nimi" required>

        <!-- Tag (Aihe) -->
        <label for="topic" class="required">Aihe<span class="required-asterisk">*</span></label>
        <input type="text" id="topic" name="topic" placeholder="Aihe" required>

        <!-- Date -->
        <label for="date" class="required">Päivämäärä (pp.kk.vvvv)<span class="required-asterisk">*</span></label>
        <input type="text" id="date" name="date" placeholder="pp.kk.vvvv" required>

        <!-- Start and End Time -->
        <label for="start_time" class="required">Alkamisaika<span class="required-asterisk">*</span></label>
        <input type="time" id="start_time" name="start_time" required>
        <label for="end_time">Päättymisaika</label>
        <input type="time" id="end_time" name="end_time">

        <!-- Additional Information -->
        <label for="facebook">Facebook-tapahtumalinkki (valinnainen)</label>
        <input type="url" id="facebook" name="facebook" placeholder="https://facebook.com/event">

        <!-- Organizers -->
        <label for="organizers" class="required">Järjestäjä(t)<span class="required-asterisk">*</span></label>
        <div id="organizers-container"></div>
        <button type="button" class="add-organizer-button" onclick="addOrganizer()">Lisää järjestäjä</button>

        <!-- Location Type -->
        <label for="type" class="required">Tyyppi<span class="required-asterisk">*</span></label>
        <select id="type" name="type" required>
            <option value="" disabled selected>Valitse mielenosoituksen tyyppi</option>
            <option value="paikallaan">Paikallaan</option>
            <option value="marssi">Marssi</option>
            <option value="muut">Muut</option>
        </select>

        <div id="march-route-container" class="optional-section">
            <label for="route">Reitti (vain marssille, valinnainen)</label>
            <textarea id="route" name="route" placeholder="Reitti..."></textarea>
        </div>

        <div class="form-group required">
            <label for="city">Paikkakunta<span class="required-asterisk">*</span></label>
            <div class="dropdown">
                <button type="button" class="dropbtn">Paikkakunta</button>
                <br>
                <div id="dropdown-content" class="dropdown-content">
                    <input type="text" placeholder="Hae paikkakunta..." id="searchInput" onkeyup="filterFunction()">
                    <!-- List of cities -->
                    {% for city in ['Akaa', 'Alajärvi', 'Alavieska', 'Alavus', 'Asikkala', 'Askola', 'Aura', 'Brändö', 'Eckerö', 'Enonkoski', 'Enontekiö', 'Espoo', 'Eura', 'Eurajoki', 'Evijärvi', 'Finström', 'Forssa', 'Föglö', 'Geta', 'Haapajärvi', 'Haapavesi', 'Hailuoto', 'Halsua', 'Hamina', 'Hammarland', 'Hankasalmi', 'Hanko', 'Harjavalta', 'Hartola', 'Hattula', 'Hausjärvi', 'Heinola', 'Heinävesi', 'Helsinki', 'Hirvensalmi', 'Hollola', 'Huittinen', 'Humppila', 'Hyrynsalmi', 'Hyvinkää', 'Hämeenkyrö', 'Hämeenlinna', 'Ii', 'Iisalmi', 'Iitti', 'Ikaalinen', 'Ilmajoki', 'Ilomantsi', 'Imatra', 'Inari', 'Inkoo', 'Isojoki', 'Isokyrö', 'Janakkala', 'Joensuu', 'Jokioinen', 'Jomala', 'Joroinen', 'Joutsa', 'Juuka', 'Juupajoki', 'Juva', 'Jyväskylä', 'Jämijärvi', 'Jämsä', 'Järvenpää', 'Kaarina', 'Kaavi', 'Kajaani', 'Kalajoki', 'Kangasala', 'Kangasniemi', 'Kankaanpää', 'Kannonkoski', 'Kannus', 'Karijoki', 'Karkkila', 'Karstula', 'Karvia', 'Kaskinen', 'Kauhajoki', 'Kauhava', 'Kauniainen', 'Kaustinen', 'Keitele', 'Kemi', 'Kemijärvi', 'Keminmaa', 'Kemiönsaari', 'Kempele', 'Kerava', 'Keuruu', 'Kihniö', 'Kinnula', 'Kirkkonummi', 'Kitee', 'Kittilä', 'Kiuruvesi', 'Kivijärvi', 'Kokemäki', 'Kokkola', 'Kolari', 'Konnevesi', 'Kontiolahti', 'Korsnäs', 'Koski Tl', 'Kotka', 'Kouvola', 'Kristiinankaupunki', 'Kruunupyy', 'Kuhmo', 'Kuhmoinen', 'Kumlinge', 'Kuopio', 'Kuortane', 'Kurikka', 'Kustavi', 'Kuusamo', 'Kyyjärvi', 'Kärkölä', 'Kärsämäki', 'Kökar', 'Lahti', 'Laihia', 'Laitila', 'Lapinjärvi', 'Lapinlahti', 'Lappajärvi', 'Lappeenranta', 'Lapua', 'Laukaa', 'Lemi', 'Lemland', 'Lempäälä', 'Leppävirta', 'Lestijärvi', 'Lieksa', 'Lieto', 'Liminka', 'Liperi', 'Lohja', 'Loimaa', 'Loppi', 'Loviisa', 'Luhanka', 'Lumijoki', 'Lumparland', 'Luoto', 'Luumäki', 'Maalahti', 'Maarianhamina – Mariehamn', 'Marttila', 'Masku', 'Merijärvi', 'Merikarvia', 'Miehikkälä', 'Mikkeli', 'Muhos', 'Multia', 'Muonio', 'Mustasaari', 'Muurame', 'Mynämäki', 'Myrskylä', 'Mäntsälä', 'Mänttä-Vilppula', 'Mäntyharju', 'Naantali', 'Nakkila', 'Nivala', 'Nokia', 'Nousiainen', 'Nurmes', 'Nurmijärvi', 'Närpiö', 'Orimattila', 'Oripää', 'Orivesi', 'Oulainen', 'Oulu', 'Outokumpu', 'Padasjoki', 'Paimio', 'Paltamo', 'Parainen', 'Parikkala', 'Parkano', 'Pedersöre', 'Pelkosenniemi', 'Pello', 'Perho', 'Pertunmaa', 'Petäjävesi', 'Pieksämäki', 'Pielavesi', 'Pietarsaari', 'Pihtipudas', 'Pirkkala', 'Polvijärvi', 'Pomarkku', 'Pori', 'Pornainen', 'Porvoo', 'Posio', 'Pudasjärvi', 'Pukkila', 'Punkalaidun', 'Puolanka', 'Puumala', 'Pyhtää', 'Pyhäjoki', 'Pyhäjärvi', 'Pyhäntä', 'Pyhäranta', 'Pälkäne', 'Pöytyä', 'Raahe', 'Raasepori', 'Raisio', 'Rantasalmi', 'Ranua', 'Rauma', 'Rautalampi', 'Rautavaara', 'Rautjärvi', 'Reisjärvi', 'Riihimäki', 'Ristijärvi', 'Rovaniemi', 'Ruokolahti', 'Ruovesi', 'Rusko', 'Rääkkylä', 'Saarijärvi', 'Salla', 'Salo', 'Saltvik', 'Sastamala', 'Sauvo', 'Savitaipale', 'Savonlinna', 'Savukoski', 'Seinäjoki', 'Sievi', 'Siikainen', 'Siikajoki', 'Siikalatva', 'Siilinjärvi', 'Simo', 'Sipoo', 'Siuntio', 'Sodankylä', 'Soini', 'Somero', 'Sonkajärvi', 'Sotkamo', 'Sottunga', 'Sulkava', 'Sund', 'Suomussalmi', 'Suonenjoki', 'Sysmä', 'Säkylä', 'Taipalsaari', 'Taivalkoski', 'Taivassalo', 'Tammela', 'Tampere', 'Tervo', 'Tervola', 'Teuva', 'Tohmajärvi', 'Toholampi', 'Toivakka', 'Tornio', 'Turku', 'Tuusniemi', 'Tuusula', 'Tyrnävä', 'Ulvila', 'Urjala', 'Utajärvi', 'Utsjoki', 'Uurainen', 'Uusikaarlepyy', 'Uusikaupunki', 'Vaala', 'Vaasa', 'Valkeakoski', 'Vantaa', 'Varkaus', 'Vehmaa', 'Vesanto', 'Vesilahti', 'Veteli', 'Vieremä', 'Vihti', 'Viitasaari', 'Vimpeli', 'Virolahti', 'Virrat', 'Vårdö', 'Vöyri', 'Ylitornio', 'Ylivieska', 'Ylöjärvi', 'Ypäjä', 'Ähtäri', 'Äänekoski'] %}
                    <a href="#" onclick="selectCity('{{ city }}'); return false;">{{ city }}</a>
                    {% endfor %}
                </div>
            </div>
            <input type="hidden" id="selected-city" name="city" value="" required>
        </div>

        <label for="address" class="required">Katuosoite<span class="required-asterisk">*</span></label>
        <input type="text" id="address" name="address" placeholder="Katuosoite" required>

        <button type="submit" class="submit-button">Lähetä</button>
    </form>
</div>

<script>
    let organizerCount = 0;

    function addOrganizer() {
        organizerCount++;
        const container = document.getElementById('organizers-container');
        const organizerDiv = document.createElement('div');
        organizerDiv.className = 'organizer';

        organizerDiv.innerHTML = `
            <div class="organizer-entry">
                <hr>
                <p>Järjestäjätahon...</p>
                <label for="organizer_name_${organizerCount}">Nimi<span class="required-asterisk">*</span></label>
                <input type="text" id="organizer_name_${organizerCount}" name="organizer_name_${organizerCount}" placeholder="Järjestäjän nimi" required>

                <label for="organizer_website_${organizerCount}">Verkkosivut</label>
                <input type="url" id="organizer_website_${organizerCount}" name="organizer_website_${organizerCount}" placeholder="https://example.com">

                <label for="organizer_email_${organizerCount}">Sähköpostiosoite</label>
                <input type="email" id="organizer_email_${organizerCount}" name="organizer_email_${organizerCount}" placeholder="sähköposti@example.com">
            </div>
        `;

        container.appendChild(organizerDiv);
    }

    document.getElementById('type').addEventListener('change', function () {
        var marchRouteContainer = document.getElementById('march-route-container');
        if (this.value === 'marssi') {
            marchRouteContainer.style.display = 'block';
        } else {
            marchRouteContainer.style.display = 'none';
        }
    });

    
    // Paikkakunta dropdown functions
    function selectCity(city) {
        document.querySelector('.dropbtn').textContent = city;
        document.getElementById('selected-city').value = city;
        document.getElementById('dropdown-content').style.display = 'none';
    }

    function filterFunction() {
        let input, filter, div, a, i;
        input = document.getElementById('searchInput');
        if (input !== '') {
            filter = input.value.toUpperCase();
            div = document.getElementById('dropdown-content');
            a = div.getElementsByTagName('a');
            for (i = 0; i < a.length; i++) {
                let txtValue = a[i].textContent || a[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    a[i].style.display = '';
                } else {
                    a[i].style.display = 'none';
                }
            }
        }
    }

    document.querySelector('.dropbtn').addEventListener('click', function () {
        document.getElementById('dropdown-content').style.display = 'block';
    });

    window.onclick = function (event) {
        console.log(event.target);
        if (!event.target.matches('.dropdown')) {
            if (event.target !== document.getElementByClassName("dropdown-content")) {
                var dropdowns = document.getElementsByClassName('dropdown-content');
                for (let i = 0; i < dropdowns.length; i++) {
                    let openDropdown = dropdowns[i];
                    if (openDropdown.style.display === 'block') {
                        openDropdown.style.display = 'none';
                    }
                }
            }
        }
    };
</script>
<style>
    .required {
        color: #333;
    }
    .required-asterisk {
        color: red;
        margin-left: 5px;
    }
    .optional-section {
        display: none;
    }
</style>
{% endblock %}
