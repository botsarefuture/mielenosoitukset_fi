<div id="demo-toolbox" class="toolbox-sticky">
    <div class="toolbox-header">
        <h3>{{ _('Työkalupakki') }}</h3>
    </div>

    <div id="toolbox-buttons" class="toolbox-buttons">
        <!-- Approve Button -->
        {% if not demo.approved and current_user.has_permission("ACCEPT_DEMO") %}
        <button class="button accept-button" onclick="acceptDemo('{{ demo['_id'] }}')">
            <i class="fa-solid fa-check"></i> {{ _('Hyväksy') }}
        </button>
        {% endif %}

        <!-- Edit Button -->
        {% if current_user.has_permission("EDIT_DEMO") %}
        <a href="{{ url_for('admin_demo.edit_demo', demo_id=demo['_id']) }}" class="button edit-button">
            <i class="fas fa-edit"></i> {{ _('Muokkaa') }}
        </a>
        {% endif %}

        <!-- View Button -->
        {% if current_user.has_permission("VIEW_DEMO") %}
        <a href="{{ url_for('demonstration_detail', demo_id=demo['_id']) }}" class="button view-button">
            <i class="fa-solid fa-eye"></i> {{ _('Katsele') }}
        </a>
        {% endif %}

        <!-- Delete Button -->
        {% if current_user.has_permission("DELETE_DEMO") %}
        <button class="button delete-button" onclick="openModal(event, '{{ demo.title }}', '{{ demo['_id'] }}')">
            <i class="fas fa-trash-alt"></i> {{ _('Poista') }}
        </button>
        {% endif %}

        <!-- Stats Button -->
        {% if current_user.has_permission("VIEW_ANALYTICS") %}
        <a href="{{ url_for('admin.stats') }}" class="button stats-button">
            <i class="fas fa-chart-line"></i> {{ _('Tilastot') }}
        </a>

        <div id="stats-content">
            <!-- Stats will be injected here by JavaScript -->
        </div>
        {% endif %}
        <!-- the toggle here -->
        <button class="button toggle-toolbox" onclick="toggleToolbox()">
            <i class="fa-solid fa-toolbox"></i>
        </button>
    </div>
</div>

{% if current_user.has_permission("VIEW_ANALYTICS") %}
<script>
    function get_demo_stats(demoId) {
        fetch(`/api/demo/${demoId}/stats`)
            .then((response) => response.json())
            .then((data) => {
                const statsContent = document.getElementById("stats-content");
                statsContent.innerHTML = `
                    <p><strong><i class="fa-solid fa-eye"></i> {{ _('Näyttökerrat:') }}</strong> ${data.views}</p>
                    <p><strong>{{ _('Osallistujat:') }}</strong> ${data.participants}</p>
                `;
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    document.addEventListener("DOMContentLoaded", () => {
        get_demo_stats("{{ demo['_id'] }}");
    });
</script>
{% endif %}
